<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Sam Rowe (samrowe101@gmail.com)" />


<title>Randomized Equivalence Study Evaluating the Efficacy of Two Commercial Internal Teat Sealants in Dairy Cows: Cow-level outcomes</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/table1-1.0/table1_defaults.css" rel="stylesheet" />
<script src="site_libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="site_libs/d3-3.3.8/d3.min.js"></script>
<script src="site_libs/dagre-0.4.0/dagre-d3.min.js"></script>
<link href="site_libs/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet" />
<script src="site_libs/mermaid-0.3.0/dist/mermaid.slim.min.js"></script>
<link href="site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="site_libs/chromatography-0.1/chromatography.js"></script>
<script src="site_libs/DiagrammeR-binding-1.0.1/DiagrammeR.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">2019 Internal Tealant Trial</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Dry period IMI dynamics</a>
</li>
<li>
  <a href="CowAnalysis.html">Post-calving outcomes</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Randomized Equivalence Study Evaluating the Efficacy of Two Commercial Internal Teat Sealants in Dairy Cows: Cow-level outcomes</h1>
<h4 class="author">Sam Rowe (<a href="mailto:samrowe101@gmail.com" class="email">samrowe101@gmail.com</a>)</h4>
<h4 class="date">September 1st, 2019</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#evaluate-data">Evaluate Data</a><ul>
<li><a href="#show-first-10-rows-of-baseline">Show first 10 rows of baseline</a></li>
<li><a href="#inspect-data">Inspect Data</a></li>
<li><a href="#compare-treatment-groups">Compare treatment groups</a></li>
<li><a href="#compare-herds">Compare herds</a></li>
</ul></li>
<li><a href="#outcome-1-clinical-mastitis">Outcome 1: Clinical mastitis</a><ul>
<li><a href="#clinical-mastitis-risk">100 Clinical mastitis risk</a></li>
<li><a href="#kaplan-meier-curve-log-rank-test-for-clinical-mastitis">Kaplan Meier curve &amp; log rank test for clinical mastitis</a></li>
<li><a href="#log-rank-test">Log-Rank test</a></li>
<li><a href="#cox-proportional-hazards-regression-for-clinical-mastitis-1-100-dim">Cox proportional hazards regression for clinical mastitis (1-100 DIM)</a></li>
<li><a href="#model-building-plan">Model building plan</a><ul>
<li><a href="#step-1-dag-for-clincal-mastitis">Step 1: DAG for clincal mastitis</a></li>
<li><a href="#step-2-identify-correlated-covariates">Step 2: Identify correlated covariates</a></li>
<li><a href="#step-3-create-model-with-all-potential-covariates">Step 3: Create model with all potential covariates</a></li>
<li><a href="#step-4-schoenfield-tests-to-assess-assumption-of-proportional-hazards-for-explanatory-variables.">Step 4: Schoenfield tests to assess assumption of proportional hazards for explanatory variables.</a></li>
<li><a href="#step-5-investigate-effect-measure-modification">Step 5: Investigate effect measure modification</a></li>
<li><a href="#step-6-remove-unnecessary-covariates-backwards-selection-using-10-rule">Step 6: Remove unnecessary covariates (backwards selection using 10% rule)</a></li>
<li><a href="#step-7a-reporting-final-cox-model-for-clinical-mastitis-1-100-dim">Step 7a: Reporting final cox model for clinical mastitis (1-100 DIM)</a></li>
</ul></li>
</ul></li>
<li><a href="#outcome-2-culling-or-death">Outcome 2: Culling or death</a><ul>
<li><a href="#d-culling-or-death-risk">100 d Culling or death risk</a></li>
<li><a href="#kaplan-meier-curve-log-rank-test-for-culling-or-death">Kaplan Meier curve &amp; log rank test for culling or death</a></li>
<li><a href="#log-rank-test-1">Log-Rank test</a></li>
<li><a href="#cox-proportional-hazards-regression-for-culling-or-death-1-100-dim">Cox proportional hazards regression for culling or death (1-100 DIM)</a></li>
<li><a href="#model-building-plan-1">Model building plan</a><ul>
<li><a href="#step-1-dag-for-culling-or-death">Step 1: DAG for culling or death</a></li>
<li><a href="#step-2-identify-correlated-covariates-1">Step 2: Identify correlated covariates</a></li>
<li><a href="#step-3-create-model-with-all-potential-covariates-1">Step 3: Create model with all potential covariates</a></li>
<li><a href="#step-4-schoenfield-tests-to-assess-assumption-of-proportional-hazards-for-explanatory-variables.-1">Step 4: Schoenfield tests to assess assumption of proportional hazards for explanatory variables.</a></li>
<li><a href="#step-5-investigate-effect-measure-modification-1">Step 5: Investigate effect measure modification</a></li>
<li><a href="#step-6-remove-unnecessary-covariates-backwards-selection-using-10-rule-1">Step 6: Remove unnecessary covariates (backwards selection using 10% rule)</a></li>
<li><a href="#step-7a-reporting-final-cox-model-for-culling-or-death-1-100-dim">Step 7a: Reporting final cox model for culling or death (1-100 DIM)</a></li>
</ul></li>
</ul></li>
<li><a href="#changing-datasets-dhi-dataset-with-multiple-rows-per-cow">Changing datasets: DHI dataset with multiple rows per cow</a></li>
<li><a href="#inspect-data-1">Inspect data</a><ul>
<li><a href="#assessing-normality-for-continuous-outcome-variables">Assessing normality for continuous outcome variables</a></li>
</ul></li>
<li><a href="#outcome-3-somatic-cell-count">Outcome 3: Somatic cell count</a><ul>
<li><a href="#modelling-plan">Modelling plan</a><ul>
<li><a href="#step-1-identify-potential-confounders-using-a-dag">Step 1 Identify potential confounders using a DAG</a></li>
<li><a href="#step-2-identify-correlated-covariates-2">Step 2: Identify correlated covariates</a></li>
<li><a href="#step-3-create-model-with-all-potential-confounders">Step 3: Create model with all potential confounders</a></li>
<li><a href="#step-4-investigate-effect-measure-modification">Step 4: Investigate effect measure modification</a></li>
<li><a href="#step-5-remove-unneccesary-covariates-in-backwards-stepwise-fashion-using-10-rule">Step 5: Remove unneccesary covariates in backwards stepwise fashion using 10% rule</a></li>
<li><a href="#step-6a-final-model">Step 6a: Final model</a></li>
<li><a href="#step-6b-final-model-reported-as-estimated-marginal-means-lsmeans">Step 6b: Final model reported as estimated marginal means (~LSmeans)</a></li>
<li><a href="#step-6c-final-model-reported-as-back-transformed-estimated-marginal-means-lsmeans">Step 6c: Final model reported as back-transformed estimated marginal means (~LSmeans)</a></li>
<li><a href="#step-7-model-diagnostics">Step 7: Model diagnostics</a></li>
</ul></li>
</ul></li>
<li><a href="#outcome-4-milk-yield-0-100-dim">Outcome 4: Milk yield (0-100 DIM)</a><ul>
<li><a href="#modelling-plan-1">Modelling plan</a><ul>
<li><a href="#steps-1-and-2-identify-potential-confounders-using-a-dag">Steps 1 and 2: Identify potential confounders using a DAG</a></li>
<li><a href="#step-3-create-model-with-all-potential-confounders-1">Step 3: Create model with all potential confounders</a></li>
<li><a href="#step-4-investigate-effect-measure-modification-1">Step 4: Investigate effect measure modification</a></li>
<li><a href="#step-5-remove-unneccesary-covariates-in-backwards-stepwise-fashion-using-10-rule-1">Step 5: Remove unneccesary covariates in backwards stepwise fashion using 10% rule</a></li>
<li><a href="#step-6-final-model">Step 6: Final model</a></li>
<li><a href="#step-6b-final-model-using-10-rule-reported-as-estimated-marginal-means-lsmeans">Step 6b: Final model (using 10% rule) reported as estimated marginal means (~LSmeans)</a></li>
<li><a href="#step-7-model-diagnostics-1">Step 7: Model diagnostics</a></li>
</ul></li>
</ul></li>
</ul>
</div>

<p><br> <br> <br></p>
<pre class="css"><code>pre code {
 white-space: 
}</code></pre>
<style type="text/css">
pre code {
 white-space: 
}
</style>
<pre class="r"><code>library(knitr)</code></pre>
<pre class="r"><code>#Windows
setwd(&quot;C:/Users/rowe0122/Dropbox/R backup/Lockout - R/LOCKOUT&quot;)
#Mac
#setwd(&quot;~/Dropbox/R backup/Lockout - R/LOCKOUT&quot;)
load(file=&quot;lockcowdat.Rdata&quot;)
load(file=&quot;lockcowdhidat.Rdata&quot;)</code></pre>
<pre class="r"><code>library(dplyr)</code></pre>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<pre class="r"><code>lockcow = lockcow %&gt;%
  mutate(Tx = recode(lockcow$Tx,
                     &quot;0&quot; = &quot;Orbeseal&quot;, &quot;1&quot; = &quot;Lockout&quot;))

lockcowdhi = lockcowdhi %&gt;%
  mutate(Tx = recode(lockcowdhi$Tx,
                     &quot;0&quot; = &quot;Orbeseal&quot;, &quot;1&quot; = &quot;Lockout&quot;))</code></pre>
<div id="evaluate-data" class="section level1">
<h1>Evaluate Data</h1>
<div id="show-first-10-rows-of-baseline" class="section level2">
<h2>Show first 10 rows of baseline</h2>
<pre class="r"><code>Desc1 &lt;- lockcow %&gt;% select(Cow,FARMID,Tx,Age,Parity,SCCDO,MYDO,DIMDO,CM1,PeakSCC,DPlength,CM2,Rem2)
head(Desc1, n=10)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Cow"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["FARMID"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Tx"],"name":[3],"type":["fctr"],"align":["left"]},{"label":["Age"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Parity"],"name":[5],"type":["fctr"],"align":["left"]},{"label":["SCCDO"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["MYDO"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["DIMDO"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["CM1"],"name":[9],"type":["fctr"],"align":["left"]},{"label":["PeakSCC"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["DPlength"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["CM2"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["Rem2"],"name":[13],"type":["dbl"],"align":["right"]}],"data":[{"1":"6.293419","2":"4","3":"Lockout","4":"57.89474","5":"3","6":"5.049856","7":"29.93707","8":"292","9":"0","10":"5.351858","11":"57","12":"0","13":"0","_rn_":"1"},{"1":"6.329721","2":"5","3":"Orbeseal","4":"76.15132","5":"4","6":"4.430817","7":"24.49397","8":"322","9":"1","10":"5.273000","11":"65","12":"0","13":"1","_rn_":"2"},{"1":"6.336826","2":"5","3":"Lockout","4":"31.28289","5":"1","6":"4.465908","7":"19.95805","8":"291","9":"0","10":"5.036953","11":"45","12":"0","13":"0","_rn_":"3"},{"1":"6.472346","2":"5","3":"Orbeseal","4":"44.21053","5":"2","6":"4.691348","7":"15.42213","8":"297","9":"1","10":"7.615791","11":"59","12":"1","13":"0","_rn_":"4"},{"1":"6.495266","2":"5","3":"Lockout","4":"46.80921","5":"2","6":"4.060443","7":"23.58678","8":"364","9":"0","10":"4.488636","11":"47","12":"1","13":"0","_rn_":"5"},{"1":"6.496775","2":"5","3":"Orbeseal","4":"48.09211","5":"2","6":"5.129899","7":"22.67960","8":"370","9":"0","10":"5.564520","11":"48","12":"0","13":"0","_rn_":"6"},{"1":"6.513230","2":"5","3":"Lockout","4":"61.71053","5":"3","6":"5.365976","7":"47.17357","8":"299","9":"0","10":"6.786717","11":"63","12":"0","13":"0","_rn_":"7"},{"1":"6.553933","2":"5","3":"Lockout","4":"20.52632","5":"1","6":"4.812184","7":"22.67960","8":"298","9":"0","10":"8.493720","11":"54","12":"0","13":"1","_rn_":"8"},{"1":"6.568078","2":"5","3":"Lockout","4":"42.30263","5":"2","6":"6.028279","7":"24.49397","8":"289","9":"0","10":"6.131226","11":"53","12":"0","13":"0","_rn_":"9"},{"1":"6.584791","2":"5","3":"Orbeseal","4":"21.05263","5":"1","6":"4.820282","7":"15.42213","8":"426","9":"0","10":"4.934474","11":"42","12":"0","13":"1","_rn_":"10"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br></p>
</div>
<div id="inspect-data" class="section level2">
<h2>Inspect Data</h2>
<pre class="r"><code>#summarytools::dfSummary(Baseline, style=&#39;grid&#39;)
print(summarytools::dfSummary(Desc1,valid.col=FALSE, graph.magnif=0.8, style=&quot;grid&quot;))</code></pre>
<pre><code>## Data Frame Summary  
##   
## Dimensions: 834 x 13  
## Duplicates: 0  
## 
## +----+-----------+--------------------------+---------------------+------------------------------------+---------+
## | No | Variable  | Stats / Values           | Freqs (% of Valid)  | Graph                              | Missing |
## +====+===========+==========================+=====================+====================================+=========+
## | 1  | Cow       | Mean (sd) : 9.4 (1.3)    | 827 distinct values |       .       .   :                | 0       |
## |    | [numeric] | min &lt; med &lt; max:         |                     |       :       : : :                | (0%)    |
## |    |           | 6.3 &lt; 10.1 &lt; 11.2        |                     |       :       : : :                |         |
## |    |           | IQR (CV) : 2.1 (0.1)     |                     |     . : :     : : :                |         |
## |    |           |                          |                     | . . : : : :   : : :                |         |
## +----+-----------+--------------------------+---------------------+------------------------------------+---------+
## | 2  | FARMID    | Mean (sd) : 3 (1.3)      | 1 : 183 (21.9%)     | IIII                               | 0       |
## |    | [numeric] | min &lt; med &lt; max:         | 2 :  80 ( 9.6%)     | I                                  | (0%)    |
## |    |           | 1 &lt; 3 &lt; 5                | 3 : 289 (34.6%)     | IIIIII                             |         |
## |    |           | IQR (CV) : 2 (0.5)       | 4 : 149 (17.9%)     | III                                |         |
## |    |           |                          | 5 : 133 (16.0%)     | III                                |         |
## +----+-----------+--------------------------+---------------------+------------------------------------+---------+
## | 3  | Tx        | 1. Orbeseal              | 415 (49.8%)         | IIIIIIIII                          | 0       |
## |    | [factor]  | 2. Lockout               | 419 (50.2%)         | IIIIIIIIII                         | (0%)    |
## +----+-----------+--------------------------+---------------------+------------------------------------+---------+
## | 4  | Age       | Mean (sd) : 46.1 (15.5)  | 572 distinct values |   :                                | 0       |
## |    | [numeric] | min &lt; med &lt; max:         |                     |   :                                | (0%)    |
## |    |           | 17 &lt; 44 &lt; 117            |                     |   : .                              |         |
## |    |           | IQR (CV) : 23.1 (0.3)    |                     |   : : : .                          |         |
## |    |           |                          |                     |   : : : : : .                      |         |
## +----+-----------+--------------------------+---------------------+------------------------------------+---------+
## | 5  | Parity    | 1. 1                     | 353 (42.3%)         | IIIIIIII                           | 0       |
## |    | [factor]  | 2. 2                     | 244 (29.3%)         | IIIII                              | (0%)    |
## |    |           | 3. 3                     | 151 (18.1%)         | III                                |         |
## |    |           | 4. 4                     |  86 (10.3%)         | II                                 |         |
## +----+-----------+--------------------------+---------------------+------------------------------------+---------+
## | 6  | SCCDO     | Mean (sd) : 4.6 (1.2)    | 332 distinct values |         :                          | 0       |
## |    | [numeric] | min &lt; med &lt; max:         |                     |       . : .                        | (0%)    |
## |    |           | 0 &lt; 4.6 &lt; 8.9            |                     |       : : :                        |         |
## |    |           | IQR (CV) : 1.5 (0.3)     |                     |       : : :                        |         |
## |    |           |                          |                     |     . : : : : .                    |         |
## +----+-----------+--------------------------+---------------------+------------------------------------+---------+
## | 7  | MYDO      | Mean (sd) : 25.4 (9)     | 92 distinct values  |           :                        | 0       |
## |    | [numeric] | min &lt; med &lt; max:         |                     |         : : :                      | (0%)    |
## |    |           | 1.8 &lt; 25.6 &lt; 49          |                     |     : : : : : .                    |         |
## |    |           | IQR (CV) : 13.6 (0.4)    |                     |     : : : : : :                    |         |
## |    |           |                          |                     | . : : : : : : : : .                |         |
## +----+-----------+--------------------------+---------------------+------------------------------------+---------+
## | 8  | DIMDO     | Mean (sd) : 330.2 (67)   | 196 distinct values | :                                  | 0       |
## |    | [numeric] | min &lt; med &lt; max:         |                     | :                                  | (0%)    |
## |    |           | 256 &lt; 307 &lt; 869          |                     | : .                                |         |
## |    |           | IQR (CV) : 62 (0.2)      |                     | : :                                |         |
## |    |           |                          |                     | : : : .                            |         |
## +----+-----------+--------------------------+---------------------+------------------------------------+---------+
## | 9  | CM1       | 1. 0                     | 620 (74.3%)         | IIIIIIIIIIIIII                     | 0       |
## |    | [factor]  | 2. 1                     | 214 (25.7%)         | IIIII                              | (0%)    |
## +----+-----------+--------------------------+---------------------+------------------------------------+---------+
## | 10 | PeakSCC   | Mean (sd) : 5.8 (1.3)    | 545 distinct values |       :                            | 0       |
## |    | [numeric] | min &lt; med &lt; max:         |                     |       : .                          | (0%)    |
## |    |           | 3 &lt; 5.6 &lt; 9.2            |                     |     : : : :                        |         |
## |    |           | IQR (CV) : 1.7 (0.2)     |                     |   : : : : : : .                    |         |
## |    |           |                          |                     | . : : : : : : : : .                |         |
## +----+-----------+--------------------------+---------------------+------------------------------------+---------+
## | 11 | DPlength  | Mean (sd) : 54.9 (8.7)   | 50 distinct values  |       :   :                        | 0       |
## |    | [numeric] | min &lt; med &lt; max:         |                     |       : : :                        | (0%)    |
## |    |           | 30 &lt; 55 &lt; 85             |                     |     . : : : .                      |         |
## |    |           | IQR (CV) : 13 (0.2)      |                     |     : : : : :                      |         |
## |    |           |                          |                     | . : : : : : : :                    |         |
## +----+-----------+--------------------------+---------------------+------------------------------------+---------+
## | 12 | CM2       | Min  : 0                 | 0 : 676 (81.1%)     | IIIIIIIIIIIIIIII                   | 0       |
## |    | [numeric] | Mean : 0.2               | 1 : 158 (18.9%)     | III                                | (0%)    |
## |    |           | Max  : 1                 |                     |                                    |         |
## +----+-----------+--------------------------+---------------------+------------------------------------+---------+
## | 13 | Rem2      | Min  : 0                 | 0 : 746 (89.5%)     | IIIIIIIIIIIIIIIII                  | 0       |
## |    | [numeric] | Mean : 0.1               | 1 :  88 (10.5%)     | II                                 | (0%)    |
## |    |           | Max  : 1                 |                     |                                    |         |
## +----+-----------+--------------------------+---------------------+------------------------------------+---------+</code></pre>
<p><br> <br></p>
</div>
<div id="compare-treatment-groups" class="section level2">
<h2>Compare treatment groups</h2>
<pre class="r"><code>table1::table1(~ factor(FARMID) + Age + Parity + SCCDO + PeakSCC + MYDO + as.numeric(DIMDO) + CM1 + as.numeric(DPlength) + as.factor(CM2) + as.factor(Rem2) | Tx, data=lockcow,topclass=&quot;Rtable1-grid&quot;)</code></pre>
<div class="Rtable1"><table class="Rtable1-grid">
<thead>
<tr>
<th class='rowlabel firstrow lastrow'></th>
<th class='firstrow lastrow'><span class='stratlabel'>Orbeseal<br><span class='stratn'>(n=415)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Lockout<br><span class='stratn'>(n=419)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Overall<br><span class='stratn'>(n=834)</span></span></th>
</tr>
</thead>
<tbody>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>factor(FARMID)</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>1</td>
<td>91 (21.9%)</td>
<td>92 (22.0%)</td>
<td>183 (21.9%)</td>
</tr>
<tr>
<td class='rowlabel'>2</td>
<td>39 (9.4%)</td>
<td>41 (9.8%)</td>
<td>80 (9.6%)</td>
</tr>
<tr>
<td class='rowlabel'>3</td>
<td>143 (34.5%)</td>
<td>146 (34.8%)</td>
<td>289 (34.7%)</td>
</tr>
<tr>
<td class='rowlabel'>4</td>
<td>75 (18.1%)</td>
<td>74 (17.7%)</td>
<td>149 (17.9%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>5</td>
<td class='lastrow'>67 (16.1%)</td>
<td class='lastrow'>66 (15.8%)</td>
<td class='lastrow'>133 (15.9%)</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>Age</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>46.9 (16.3)</td>
<td>45.3 (14.7)</td>
<td>46.1 (15.5)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>44.2 [18.0, 117]</td>
<td class='lastrow'>43.9 [17.0, 113]</td>
<td class='lastrow'>44.0 [17.0, 117]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>Parity</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>1</td>
<td>172 (41.4%)</td>
<td>181 (43.2%)</td>
<td>353 (42.3%)</td>
</tr>
<tr>
<td class='rowlabel'>2</td>
<td>119 (28.7%)</td>
<td>125 (29.8%)</td>
<td>244 (29.3%)</td>
</tr>
<tr>
<td class='rowlabel'>3</td>
<td>74 (17.8%)</td>
<td>77 (18.4%)</td>
<td>151 (18.1%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>4</td>
<td class='lastrow'>50 (12.0%)</td>
<td class='lastrow'>36 (8.6%)</td>
<td class='lastrow'>86 (10.3%)</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>SCCDO</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>4.54 (1.22)</td>
<td>4.57 (1.22)</td>
<td>4.55 (1.22)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>4.60 [0.00, 8.92]</td>
<td class='lastrow'>4.53 [0.00, 8.85]</td>
<td class='lastrow'>4.56 [0.00, 8.92]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>PeakSCC</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>5.71 (1.18)</td>
<td>5.82 (1.33)</td>
<td>5.77 (1.26)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>5.56 [3.00, 9.21]</td>
<td class='lastrow'>5.59 [3.09, 9.21]</td>
<td class='lastrow'>5.58 [3.00, 9.21]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>MYDO</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>25.3 (8.84)</td>
<td>25.4 (9.12)</td>
<td>25.4 (8.97)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>26.3 [2.72, 48.5]</td>
<td class='lastrow'>25.4 [1.81, 49.0]</td>
<td class='lastrow'>25.6 [1.81, 49.0]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>as.numeric(DIMDO)</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>330 (63.2)</td>
<td>330 (70.6)</td>
<td>330 (67.0)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>307 [256, 817]</td>
<td class='lastrow'>306 [260, 869]</td>
<td class='lastrow'>307 [256, 869]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>CM1</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>0</td>
<td>305 (73.5%)</td>
<td>315 (75.2%)</td>
<td>620 (74.3%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>1</td>
<td class='lastrow'>110 (26.5%)</td>
<td class='lastrow'>104 (24.8%)</td>
<td class='lastrow'>214 (25.7%)</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>as.numeric(DPlength)</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>54.8 (8.82)</td>
<td>55.0 (8.63)</td>
<td>54.9 (8.72)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>55.0 [30.0, 84.0]</td>
<td class='lastrow'>55.0 [30.0, 85.0]</td>
<td class='lastrow'>55.0 [30.0, 85.0]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>as.factor(CM2)</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>0</td>
<td>336 (81.0%)</td>
<td>340 (81.1%)</td>
<td>676 (81.1%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>1</td>
<td class='lastrow'>79 (19.0%)</td>
<td class='lastrow'>79 (18.9%)</td>
<td class='lastrow'>158 (18.9%)</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>as.factor(Rem2)</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>0</td>
<td>370 (89.2%)</td>
<td>376 (89.7%)</td>
<td>746 (89.4%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>1</td>
<td class='lastrow'>45 (10.8%)</td>
<td class='lastrow'>43 (10.3%)</td>
<td class='lastrow'>88 (10.6%)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="compare-herds" class="section level2">
<h2>Compare herds</h2>
<pre class="r"><code>table1::table1(~ Age + Parity + SCCDO + PeakSCC + MYDO + as.numeric(DIMDO) + CM1 + as.numeric(DPlength) + as.factor(CM2) + as.factor(Rem2)  | factor(FARMID), data=lockcow,topclass=&quot;Rtable1-grid&quot;)</code></pre>
<div class="Rtable1"><table class="Rtable1-grid">
<thead>
<tr>
<th class='rowlabel firstrow lastrow'></th>
<th class='firstrow lastrow'><span class='stratlabel'>1<br><span class='stratn'>(n=183)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>2<br><span class='stratn'>(n=80)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>3<br><span class='stratn'>(n=289)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>4<br><span class='stratn'>(n=149)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>5<br><span class='stratn'>(n=133)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Overall<br><span class='stratn'>(n=834)</span></span></th>
</tr>
</thead>
<tbody>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>Age</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>43.3 (13.3)</td>
<td>41.1 (10.4)</td>
<td>46.8 (14.6)</td>
<td>49.9 (17.7)</td>
<td>47.3 (18.6)</td>
<td>46.1 (15.5)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>42.3 [28.6, 90.4]</td>
<td class='lastrow'>36.6 [29.6, 71.1]</td>
<td class='lastrow'>44.7 [30.1, 103]</td>
<td class='lastrow'>46.3 [17.4, 113]</td>
<td class='lastrow'>44.6 [17.0, 117]</td>
<td class='lastrow'>44.0 [17.0, 117]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>Parity</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>1</td>
<td>82 (44.8%)</td>
<td>43 (53.8%)</td>
<td>115 (39.8%)</td>
<td>59 (39.6%)</td>
<td>54 (40.6%)</td>
<td>353 (42.3%)</td>
</tr>
<tr>
<td class='rowlabel'>2</td>
<td>67 (36.6%)</td>
<td>23 (28.8%)</td>
<td>78 (27.0%)</td>
<td>38 (25.5%)</td>
<td>38 (28.6%)</td>
<td>244 (29.3%)</td>
</tr>
<tr>
<td class='rowlabel'>3</td>
<td>20 (10.9%)</td>
<td>13 (16.2%)</td>
<td>72 (24.9%)</td>
<td>28 (18.8%)</td>
<td>18 (13.5%)</td>
<td>151 (18.1%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>4</td>
<td class='lastrow'>14 (7.7%)</td>
<td class='lastrow'>1 (1.2%)</td>
<td class='lastrow'>24 (8.3%)</td>
<td class='lastrow'>24 (16.1%)</td>
<td class='lastrow'>23 (17.3%)</td>
<td class='lastrow'>86 (10.3%)</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>SCCDO</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>4.21 (1.33)</td>
<td>4.44 (1.18)</td>
<td>4.62 (1.02)</td>
<td>4.53 (1.25)</td>
<td>4.98 (1.31)</td>
<td>4.55 (1.22)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>4.20 [0.00, 7.88]</td>
<td class='lastrow'>4.41 [2.64, 7.38]</td>
<td class='lastrow'>4.57 [2.56, 8.92]</td>
<td class='lastrow'>4.63 [0.00, 8.63]</td>
<td class='lastrow'>4.91 [0.00, 8.85]</td>
<td class='lastrow'>4.56 [0.00, 8.92]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>PeakSCC</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>5.65 (1.17)</td>
<td>5.18 (1.11)</td>
<td>5.74 (1.35)</td>
<td>5.90 (1.15)</td>
<td>6.18 (1.23)</td>
<td>5.77 (1.26)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>5.57 [3.47, 8.78]</td>
<td class='lastrow'>5.03 [3.18, 7.79]</td>
<td class='lastrow'>5.44 [3.00, 9.21]</td>
<td class='lastrow'>5.78 [3.40, 8.95]</td>
<td class='lastrow'>6.12 [3.09, 9.21]</td>
<td class='lastrow'>5.58 [3.00, 9.21]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>MYDO</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>15.5 (5.37)</td>
<td>26.4 (4.88)</td>
<td>30.3 (7.85)</td>
<td>29.3 (7.51)</td>
<td>23.0 (6.70)</td>
<td>25.4 (8.97)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>15.9 [2.72, 30.8]</td>
<td class='lastrow'>26.8 [13.6, 36.3]</td>
<td class='lastrow'>31.8 [13.2, 48.5]</td>
<td class='lastrow'>29.9 [13.6, 49.0]</td>
<td class='lastrow'>23.6 [1.81, 47.2]</td>
<td class='lastrow'>25.6 [1.81, 49.0]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>as.numeric(DIMDO)</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>337 (99.6)</td>
<td>317 (41.8)</td>
<td>332 (62.5)</td>
<td>329 (48.5)</td>
<td>327 (46.9)</td>
<td>330 (67.0)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>307 [258, 869]</td>
<td class='lastrow'>302 [272, 466]</td>
<td class='lastrow'>312 [256, 817]</td>
<td class='lastrow'>296 [290, 469]</td>
<td class='lastrow'>305 [264, 491]</td>
<td class='lastrow'>307 [256, 869]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>CM1</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>0</td>
<td>153 (83.6%)</td>
<td>70 (87.5%)</td>
<td>177 (61.2%)</td>
<td>122 (81.9%)</td>
<td>98 (73.7%)</td>
<td>620 (74.3%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>1</td>
<td class='lastrow'>30 (16.4%)</td>
<td class='lastrow'>10 (12.5%)</td>
<td class='lastrow'>112 (38.8%)</td>
<td class='lastrow'>27 (18.1%)</td>
<td class='lastrow'>35 (26.3%)</td>
<td class='lastrow'>214 (25.7%)</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>as.numeric(DPlength)</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>54.8 (9.63)</td>
<td>55.2 (7.63)</td>
<td>54.1 (9.92)</td>
<td>57.5 (5.74)</td>
<td>53.5 (7.42)</td>
<td>54.9 (8.72)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>54.0 [30.0, 79.0]</td>
<td class='lastrow'>56.0 [36.0, 79.0]</td>
<td class='lastrow'>52.0 [30.0, 85.0]</td>
<td class='lastrow'>58.0 [35.0, 73.0]</td>
<td class='lastrow'>53.0 [30.0, 72.0]</td>
<td class='lastrow'>55.0 [30.0, 85.0]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>as.factor(CM2)</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>0</td>
<td>166 (90.7%)</td>
<td>62 (77.5%)</td>
<td>202 (69.9%)</td>
<td>133 (89.3%)</td>
<td>113 (85.0%)</td>
<td>676 (81.1%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>1</td>
<td class='lastrow'>17 (9.3%)</td>
<td class='lastrow'>18 (22.5%)</td>
<td class='lastrow'>87 (30.1%)</td>
<td class='lastrow'>16 (10.7%)</td>
<td class='lastrow'>20 (15.0%)</td>
<td class='lastrow'>158 (18.9%)</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>as.factor(Rem2)</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>0</td>
<td>167 (91.3%)</td>
<td>75 (93.8%)</td>
<td>252 (87.2%)</td>
<td>132 (88.6%)</td>
<td>120 (90.2%)</td>
<td>746 (89.4%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>1</td>
<td class='lastrow'>16 (8.7%)</td>
<td class='lastrow'>5 (6.2%)</td>
<td class='lastrow'>37 (12.8%)</td>
<td class='lastrow'>17 (11.4%)</td>
<td class='lastrow'>13 (9.8%)</td>
<td class='lastrow'>88 (10.6%)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outcome-1-clinical-mastitis" class="section level1">
<h1>Outcome 1: Clinical mastitis</h1>
<div id="clinical-mastitis-risk" class="section level2">
<h2>100 Clinical mastitis risk</h2>
<pre class="r"><code>library(gmodels)
CrossTable(lockcow$Tx,lockcow$CM2,prop.c=FALSE,prop.t=FALSE,prop.chisq = FALSE)</code></pre>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## |           N / Row Total |
## |-------------------------|
## 
##  
## Total Observations in Table:  834 
## 
##  
##              | lockcow$CM2 
##   lockcow$Tx |         0 |         1 | Row Total | 
## -------------|-----------|-----------|-----------|
##     Orbeseal |       336 |        79 |       415 | 
##              |     0.810 |     0.190 |     0.498 | 
## -------------|-----------|-----------|-----------|
##      Lockout |       340 |        79 |       419 | 
##              |     0.811 |     0.189 |     0.502 | 
## -------------|-----------|-----------|-----------|
## Column Total |       676 |       158 |       834 | 
## -------------|-----------|-----------|-----------|
## 
## </code></pre>
</div>
<div id="kaplan-meier-curve-log-rank-test-for-clinical-mastitis" class="section level2">
<h2>Kaplan Meier curve &amp; log rank test for clinical mastitis</h2>
<p>Kaplan Meier curve</p>
<pre class="r"><code>library(ggplot2)
library(survminer)
library(survival)
KM &lt;- survfit(Surv(CM2TAR, CM2) ~ Tx, data = lockcow)
#knitr::opts_chunk$set(fig.width = 800, fig.height = 900)
ggsurvplot(KM, data = lockcow,  title = &quot;&quot;, pval = T, conf.int = F,risk.table.col = &quot;Tx&quot;,risk.table = T, risk.table.y.text.col = TRUE , surv.plot.height = 5, legend.labs = c(&quot;Orbeseal&quot;,&quot;Lockout&quot;), tables.theme = theme_cleantable(), ggtheme = theme_bw(base_family = &quot;Times&quot;), palette = &quot;Set1&quot;)</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="log-rank-test" class="section level2">
<h2>Log-Rank test</h2>
<pre class="r"><code>survdiff(Surv(CM2TAR, CM2) ~ Tx,data=lockcow,rho=0)</code></pre>
<pre><code>## Call:
## survdiff(formula = Surv(CM2TAR, CM2) ~ Tx, data = lockcow, rho = 0)
## 
##               N Observed Expected (O-E)^2/E (O-E)^2/V
## Tx=Orbeseal 415       79     78.2   0.00798    0.0158
## Tx=Lockout  419       79     79.8   0.00782    0.0158
## 
##  Chisq= 0  on 1 degrees of freedom, p= 0.9</code></pre>
</div>
<div id="cox-proportional-hazards-regression-for-clinical-mastitis-1-100-dim" class="section level2">
<h2>Cox proportional hazards regression for clinical mastitis (1-100 DIM)</h2>
</div>
<div id="model-building-plan" class="section level2">
<h2>Model building plan</h2>
<p>Model type: Cox proportional hazards analysis with farm included as a cluster variable (robust sandwich standard error estimator) to account for lack of indepedence.</p>
<p>Step 1: Identify potential confouders using a directed acyclic graph (DAG)</p>
<p>Step 2: Identify correlated variables using pearson and kendalls correlation coefficients</p>
<p>Step 3: Create model with all potential confounders</p>
<p>Step 4: Investigate if covariates meet proportional hazards assumption</p>
<p>Step 5: Investigate potential effect measure modification</p>
<p>Step 6: Remove unneccesary covariates in backwards stepwise fashion using 10% rule (i.e. if hazard ratio for algorithm or culture changes by &gt;10% after removing the covariate, the covariate is retained in the model)</p>
<p>Step 7: Report final model</p>
<div id="step-1-dag-for-clincal-mastitis" class="section level3">
<h3>Step 1: DAG for clincal mastitis</h3>
<p>This is used to identify variables that could be confounders if they are not balanced between treatment groups.</p>
<pre class="r"><code>library(DiagrammeR)
mermaid(&quot;graph LR
        T(Treatment)--&gt;U(Clinical mastitis)
        A(Age)--&gt;T
        P(Parity)--&gt;T
        M(Yield at dry-off)--&gt;T
        S(SCC during prev lactation)--&gt;T
        C(CM in prev lact)--&gt;T
        D(DIM at dry-off)--&gt; T
        P--&gt;D
        D--&gt;M
        D--&gt;U
        C--&gt;D
        A--&gt;U
        P--&gt;U
        M--&gt;U
        S--&gt;U
        C--&gt;U
        C--&gt;M
        P--&gt;C
        P--&gt;S
        P--&gt;M
        A--&gt;P
        A--&gt;C
        A--&gt;S
        A--&gt;M
        M--&gt;S
        C--&gt;S
        style A fill:#FFFFFF, stroke-width:0px
        style D fill:#FFFFFF, stroke-width:0px
        style T fill:#FFFFFF, stroke-width:2px
        style P fill:#FFFFFF, stroke-width:0px
        style M fill:#FFFFFF, stroke-width:0px
        style S fill:#FFFFFF, stroke-width:0px
        style C fill:#FFFFFF, stroke-width:0px
        style I fill:#FFFFFF, stroke-width:0px
        style U fill:#FFFFFF, stroke-width:2px
        &quot;)</code></pre>
<p><div id="htmlwidget-0d7cfea0bde526d8a7a6" style="width:672px;height:480px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-0d7cfea0bde526d8a7a6">{"x":{"diagram":"graph LR\n        T(Treatment)-->U(Clinical mastitis)\n        A(Age)-->T\n        P(Parity)-->T\n        M(Yield at dry-off)-->T\n        S(SCC during prev lactation)-->T\n        C(CM in prev lact)-->T\n        D(DIM at dry-off)--> T\n        P-->D\n        D-->M\n        D-->U\n        C-->D\n        A-->U\n        P-->U\n        M-->U\n        S-->U\n        C-->U\n        C-->M\n        P-->C\n        P-->S\n        P-->M\n        A-->P\n        A-->C\n        A-->S\n        A-->M\n        M-->S\n        C-->S\n        style A fill:#FFFFFF, stroke-width:0px\n        style D fill:#FFFFFF, stroke-width:0px\n        style T fill:#FFFFFF, stroke-width:2px\n        style P fill:#FFFFFF, stroke-width:0px\n        style M fill:#FFFFFF, stroke-width:0px\n        style S fill:#FFFFFF, stroke-width:0px\n        style C fill:#FFFFFF, stroke-width:0px\n        style I fill:#FFFFFF, stroke-width:0px\n        style U fill:#FFFFFF, stroke-width:2px\n        "},"evals":[],"jsHooks":[]}</script> According to this DAG, I may need to control for the following variables.</p>
<p>Parity [“Parity”]</p>
<p>Age [“Age”]</p>
<p>Yield at most recent test before dry off [“DOMY”]</p>
<p>Somatic cell count at last herd test during previous lactation [“DOSCC” or “PeakSCC”]</p>
<p>Clinical mastitis in previous lactation [“CM2”]</p>
<p>Days in milk at dry-off [“DODIM”]</p>
<p><br> <br> <br> <br></p>
</div>
<div id="step-2-identify-correlated-covariates" class="section level3">
<h3>Step 2: Identify correlated covariates</h3>
<p>Pearson correlation matrix among potential predictors</p>
<pre class="r"><code>library(psych)
cor &lt;- Desc1[, c(4,5,6,7,8,10,11)]
cor$Parity &lt;- cor$Parity %&gt;% as.numeric
cor &lt;- cor(cor, use = &quot;complete.obs&quot;)
corPlot(cor,numbers=TRUE)</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<pre class="r"><code>cor &lt;- Desc1[, c(4,5,6,7,8,10,11)]
cor$Parity &lt;- cor$Parity %&gt;% as.numeric
cor &lt;- cor(cor, use = &quot;complete.obs&quot;, method=&quot;kendal&quot;)
corPlot(cor,numbers=TRUE)</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Age and Parity highly correlated as expected. Will only offer parity.</p>
<p><br> <br> <br> <br></p>
</div>
<div id="step-3-create-model-with-all-potential-covariates" class="section level3">
<h3>Step 3: Create model with all potential covariates</h3>
<p>Cox proportional hazards regression for clinical mastitis (1-100 DIM)</p>
<p>Cows that did not calve or that had long/short dry periods are excluded. Cows with clinical mastitis prior to calving are included.</p>
<p>Reasons for R censor = 100 DIM or culling/death</p>
<pre class="r"><code>library(broom)
library(survival)
SR &lt;- coxph(Surv(CM2TAR, CM2) ~ Parity + DIMDO + MYDO + SCCDO + CM1 + PeakSCC + Tx + cluster(FARMID), data=lockcow)
coxph(Surv(CM2TAR, CM2) ~ Parity + DIMDO + MYDO + SCCDO + CM1 + PeakSCC + Tx + cluster(FARMID), data=lockcow) %&gt;% tidy(exp=TRUE)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["robust.se"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"Parity2","2":"1.2535721","3":"0.2014686968","4":"0.1705476000","5":"1.32512639","6":"1.851292e-01","7":"0.8973852","8":"1.751135"},{"1":"Parity3","2":"1.4630731","3":"0.2186505481","4":"0.0731123693","5":"5.20485277","6":"1.941505e-07","7":"1.2677473","8":"1.688494"},{"1":"Parity4","2":"1.0186761","3":"0.2970481370","4":"0.2487444630","5":"0.07438885","6":"9.407010e-01","7":"0.6256111","8":"1.658700"},{"1":"DIMDO","2":"1.0019479","3":"0.0009953412","4":"0.0003567721","5":"5.45440913","6":"4.913595e-08","7":"1.0012475","8":"1.002649"},{"1":"MYDO","2":"1.0328562","3":"0.0095930343","4":"0.0085561813","5":"3.77831458","6":"1.578933e-04","7":"1.0156798","8":"1.050323"},{"1":"SCCDO","2":"1.1106720","3":"0.0815600441","4":"0.0171335435","5":"6.12629798","6":"8.994728e-10","7":"1.0739936","8":"1.148603"},{"1":"CM11","2":"2.5134596","3":"0.1778231196","4":"0.1759440183","5":"5.23837141","6":"1.619998e-07","7":"1.7803610","8":"3.548426"},{"1":"PeakSCC","2":"0.9858890","3":"0.0758653842","4":"0.0378486012","5":"-0.37548430","6":"7.073003e-01","7":"0.9154006","8":"1.061805"},{"1":"TxLockout","2":"0.9703038","3":"0.1602770995","4":"0.0831637080","5":"-0.36249018","6":"7.169858e-01","7":"0.8243633","8":"1.142081"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="step-4-schoenfield-tests-to-assess-assumption-of-proportional-hazards-for-explanatory-variables." class="section level3">
<h3>Step 4: Schoenfield tests to assess assumption of proportional hazards for explanatory variables.</h3>
<p>All variables are P &gt; 0.05 for the schoenfeld test.</p>
<pre class="r"><code>SR &lt;- cox.zph(SR)
SR</code></pre>
<pre><code>##                rho   chisq     p
## Parity2   -0.00412 0.00434 0.947
## Parity3    0.04493 0.58080 0.446
## Parity4    0.04519 0.38136 0.537
## DIMDO      0.00598 0.00726 0.932
## MYDO      -0.08110 1.03450 0.309
## SCCDO     -0.11218 1.99025 0.158
## CM11      -0.03890 0.54600 0.460
## PeakSCC    0.01587 0.08724 0.768
## TxLockout -0.04619 0.27021 0.603
## GLOBAL          NA 2.09747 0.990</code></pre>
<p><br> <br> <br> <br></p>
<p>Schoenfield residual plots to assess assumption of proportional hazards.</p>
<pre class="r"><code>ggcoxzph(SR,var = c(&quot;TxLockout&quot;))</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<pre class="r"><code>ggcoxzph(SR,var = c(&quot;DIMDO&quot;,&quot;MYDO&quot;))</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<pre class="r"><code>ggcoxzph(SR,var = c(&quot;SCCDO&quot;,&quot;PeakSCC&quot;))</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<pre class="r"><code>ggcoxzph(SR,var = c(&quot;Parity2&quot;,&quot;Parity3&quot;,&quot;Parity4&quot;))</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<pre class="r"><code>ggcoxzph(SR,var = c(&quot;CM11&quot;))</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>No evidence of time-varying effects on CM hazards for all predictors.</p>
<p><br> <br> <br></p>
</div>
<div id="step-5-investigate-effect-measure-modification" class="section level3">
<h3>Step 5: Investigate effect measure modification</h3>
<p>Step 5a: Treatment x Farm interaction (farmid modelled as fixed effect to explore this)</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(CM2TAR, CM2) ~ Parity + MYDO + DIMDO + SCCDO + CM1 + PeakSCC + Tx*factor(FARMID), data=lockcow)
mm0 %&gt;% tidy(exp=TRUE)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"Parity2","2":"1.2186326","3":"0.203590877","4":"0.97120978","5":"3.314438e-01","6":"0.8176660","7":"1.816225"},{"1":"Parity3","2":"1.3998372","3":"0.224783819","4":"1.49635289","5":"1.345617e-01","6":"0.9010340","7":"2.174773"},{"1":"Parity4","2":"1.1516724","3":"0.303073295","4":"0.46594379","5":"6.412557e-01","6":"0.6358468","7":"2.085957"},{"1":"MYDO","2":"1.0150177","3":"0.012116326","4":"1.23024303","5":"2.186061e-01","6":"0.9911974","7":"1.039410"},{"1":"DIMDO","2":"1.0020815","3":"0.001093338","4":"1.90179467","5":"5.719800e-02","6":"0.9999364","7":"1.004231"},{"1":"SCCDO","2":"1.0468331","3":"0.084697861","4":"0.54038620","5":"5.889307e-01","6":"0.8867119","7":"1.235869"},{"1":"CM11","2":"2.1581660","3":"0.186683434","4":"4.12065897","5":"3.777903e-05","6":"1.4968546","7":"3.111645"},{"1":"PeakSCC","2":"1.0269794","3":"0.075547246","4":"0.35238734","5":"7.245478e-01","6":"0.8856371","7":"1.190879"},{"1":"TxLockout","2":"0.6412916","3":"0.502098657","4":"-0.88482825","5":"3.762493e-01","6":"0.2397002","7":"1.715705"},{"1":"factor(FARMID)2","2":"2.0394616","3":"0.495795006","4":"1.43746075","5":"1.505871e-01","6":"0.7717810","7":"5.389358"},{"1":"factor(FARMID)3","2":"2.1000055","3":"0.404124019","4":"1.83592143","5":"6.636928e-02","6":"0.9511071","7":"4.636726"},{"1":"factor(FARMID)4","2":"0.9978728","3":"0.482111749","4":"-0.00441687","5":"9.964759e-01","6":"0.3878832","7":"2.567139"},{"1":"factor(FARMID)5","2":"0.9859616","3":"0.477942775","4":"-0.02958068","5":"9.764015e-01","6":"0.3863976","7":"2.515855"},{"1":"TxLockout:factor(FARMID)2","2":"1.7439783","3":"0.692989806","4":"0.80256427","5":"4.222266e-01","6":"0.4484015","7":"6.782894"},{"1":"TxLockout:factor(FARMID)3","2":"1.5677338","3":"0.545860539","4":"0.82371059","5":"4.101040e-01","6":"0.5378176","7":"4.569931"},{"1":"TxLockout:factor(FARMID)4","2":"0.9484138","3":"0.723164802","4":"-0.07323969","5":"9.416154e-01","6":"0.2298470","7":"3.913424"},{"1":"TxLockout:factor(FARMID)5","2":"2.0876831","3":"0.674724233","4":"1.09089740","5":"2.753180e-01","6":"0.5563374","7":"7.834132"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>mm0</code></pre>
<pre><code>## Call:
## coxph(formula = Surv(CM2TAR, CM2) ~ Parity + MYDO + DIMDO + SCCDO + 
##     CM1 + PeakSCC + Tx * factor(FARMID), data = lockcow)
## 
##                                coef exp(coef)  se(coef)      z        p
## Parity2                    0.197729  1.218633  0.203591  0.971   0.3314
## Parity3                    0.336356  1.399837  0.224784  1.496   0.1346
## Parity4                    0.141215  1.151672  0.303073  0.466   0.6413
## MYDO                       0.014906  1.015018  0.012116  1.230   0.2186
## DIMDO                      0.002079  1.002081  0.001093  1.902   0.0572
## SCCDO                      0.045770  1.046833  0.084698  0.540   0.5889
## CM11                       0.769259  2.158166  0.186683  4.121 3.78e-05
## PeakSCC                    0.026622  1.026979  0.075547  0.352   0.7245
## TxLockout                 -0.444271  0.641292  0.502099 -0.885   0.3762
## factor(FARMID)2            0.712686  2.039462  0.495795  1.437   0.1506
## factor(FARMID)3            0.741940  2.100005  0.404124  1.836   0.0664
## factor(FARMID)4           -0.002129  0.997873  0.482112 -0.004   0.9965
## factor(FARMID)5           -0.014138  0.985962  0.477943 -0.030   0.9764
## TxLockout:factor(FARMID)2  0.556169  1.743978  0.692990  0.803   0.4222
## TxLockout:factor(FARMID)3  0.449631  1.567734  0.545861  0.824   0.4101
## TxLockout:factor(FARMID)4 -0.052964  0.948414  0.723165 -0.073   0.9416
## TxLockout:factor(FARMID)5  0.736055  2.087683  0.674724  1.091   0.2753
## 
## Likelihood ratio test=81.88  on 17 df, p=1.778e-10
## n= 834, number of events= 158</code></pre>
<p><br> <br> <br> <br></p>
<p>Wald test</p>
<pre class="r"><code>library(aod)
wald.test(b = coef(mm0), Sigma = vcov(mm0), Terms = 14:17)</code></pre>
<pre><code>## Wald test:
## ----------
## 
## Chi-squared test:
## X2 = 2.1, df = 4, P(&gt; X2) = 0.71</code></pre>
<p>Wald test for interaction is p &gt; 0.05. No treatment by herd interaction.</p>
<p><br> <br> <br></p>
<p>Step 5b: Treatment x Previous clinical mastitis</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(CM2TAR, CM2) ~ Parity + DIMDO + MYDO + SCCDO + PeakSCC + Tx*CM1 + cluster(FARMID), data=lockcow)
mm0 %&gt;% tidy</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["robust.se"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"Parity2","2":"0.224676495","3":"0.201358460","4":"0.1715351819","5":"1.30979833","6":"1.902641e-01","7":"-0.1115262834","8":"0.560879274"},{"1":"Parity3","2":"0.365598648","3":"0.219135300","4":"0.0700765624","5":"5.21713159","6":"1.817152e-07","7":"0.2282511094","8":"0.502946186"},{"1":"Parity4","2":"0.022029606","3":"0.297141515","4":"0.2507859676","5":"0.08784226","6":"9.300021e-01","7":"-0.4695018585","8":"0.513561070"},{"1":"DIMDO","2":"0.001778335","3":"0.001013042","4":"0.0004316624","5":"4.11973600","6":"3.793067e-05","7":"0.0009322925","8":"0.002624378"},{"1":"MYDO","2":"0.031994435","3":"0.009609783","4":"0.0084651367","5":"3.77955329","6":"1.571100e-04","7":"0.0154030722","8":"0.048585799"},{"1":"SCCDO","2":"0.107842432","3":"0.081742813","4":"0.0179116960","5":"6.02078284","6":"1.735755e-09","7":"0.0727361527","8":"0.142948711"},{"1":"PeakSCC","2":"-0.015354782","3":"0.075951515","4":"0.0371327852","5":"-0.41351011","6":"6.792329e-01","7":"-0.0881337036","8":"0.057424140"},{"1":"TxLockout","2":"-0.173707921","3":"0.217073989","4":"0.1864895993","5":"-0.93146171","6":"3.516148e-01","7":"-0.5392208190","8":"0.191804977"},{"1":"CM11","2":"0.764161439","3":"0.240408601","4":"0.2350686992","5":"3.25080047","6":"1.150806e-03","7":"0.3034352546","8":"1.224887623"},{"1":"TxLockout:CM11","2":"0.321225192","3":"0.326576083","4":"0.3963707787","5":"0.81041593","6":"4.177012e-01","7":"-0.4556472588","8":"1.098097643"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>p &gt; 0.05. Will not explore this potential effect modification further <br> <br> <br> <br></p>
<p>Step 5c: Treatment x Parity at dry-off</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(CM2TAR, CM2) ~ DIMDO + SCCDO + PeakSCC + Tx*Parity + MYDO + CM1 + cluster(FARMID), data=lockcow)
mm0 %&gt;% tidy</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["robust.se"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"DIMDO","2":"0.001884186","3":"0.001000224","4":"0.0002965662","5":"6.3533396","6":"2.106899e-10","7":"0.001302927","8":"0.002465445"},{"1":"SCCDO","2":"0.108256501","3":"0.081720645","4":"0.0152126724","5":"7.1162054","6":"1.109390e-12","7":"0.078440211","8":"0.138072791"},{"1":"PeakSCC","2":"-0.009530706","3":"0.075639701","4":"0.0380545755","5":"-0.2504484","6":"8.022406e-01","7":"-0.084116303","8":"0.065054892"},{"1":"TxLockout","2":"-0.137624600","3":"0.270636439","4":"0.0971460634","5":"-1.4166771","6":"1.565774e-01","7":"-0.328027386","8":"0.052778185"},{"1":"Parity2","2":"0.182542627","3":"0.278661290","4":"0.1993174844","5":"0.9158385","6":"3.597516e-01","7":"-0.208112464","8":"0.573197718"},{"1":"Parity3","2":"0.122932490","3":"0.324182758","4":"0.2076546146","5":"0.5920046","6":"5.538475e-01","7":"-0.284063076","8":"0.529928056"},{"1":"Parity4","2":"0.133518738","3":"0.362703126","4":"0.2167494113","5":"0.6160051","6":"5.378912e-01","7":"-0.291302301","8":"0.558339778"},{"1":"MYDO","2":"0.031781589","3":"0.009582016","4":"0.0088130373","5":"3.6062015","6":"3.107119e-04","7":"0.014508353","8":"0.049054824"},{"1":"CM11","2":"0.899411744","3":"0.178585408","4":"0.1801466778","5":"4.9926635","6":"5.955226e-07","7":"0.546330744","8":"1.252492745"},{"1":"TxLockout:Parity2","2":"0.088558216","3":"0.396448825","4":"0.2259525302","5":"0.3919328","6":"6.951078e-01","7":"-0.354300605","8":"0.531417038"},{"1":"TxLockout:Parity3","2":"0.466120908","3":"0.427561498","4":"0.3104428360","5":"1.5014710","6":"1.332338e-01","7":"-0.142335870","8":"1.074577686"},{"1":"TxLockout:Parity4","2":"-0.358122798","3":"0.603925526","4":"0.5181823364","5":"-0.6911135","6":"4.894942e-01","7":"-1.373741514","8":"0.657495919"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Wald test</p>
<pre class="r"><code>library(aod)
wald.test(b = coef(mm0), Sigma = vcov(mm0), Terms = 10:12)</code></pre>
<pre><code>## Wald test:
## ----------
## 
## Chi-squared test:
## X2 = 8.0, df = 3, P(&gt; X2) = 0.045</code></pre>
<p>P &lt; 0.05, will explore this potential effect modification further later</p>
</div>
<div id="step-6-remove-unnecessary-covariates-backwards-selection-using-10-rule" class="section level3">
<h3>Step 6: Remove unnecessary covariates (backwards selection using 10% rule)</h3>
<p>The order for removing covariates will be in increasing likelihood of being a confounder, which is based on my knowledge about the variables and their distribution in treatment groups.</p>
<p>This order will be: DOMY, DIMDO, PeakSCC, DOSCC, Parity, CM1</p>
<p>Step 6a: Full model</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(CM2TAR, CM2) ~ Parity + DIMDO + MYDO + SCCDO + CM1 + PeakSCC + Tx + cluster(FARMID), data=lockcow)
mm0 %&gt;% tidy(exp=T) %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.9703038"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Step 6b: Remove DOMY</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(CM2TAR, CM2) ~ Parity + DIMDO + SCCDO + CM1 + PeakSCC + Tx + cluster(FARMID), data=lockcow)
mm0 %&gt;% tidy(exp=T) %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.987194"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt;10%</p>
<p><br> <br></p>
<p>Step 6c: Remove DIMDO</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(CM2TAR, CM2) ~ Parity + SCCDO + CM1 + PeakSCC + Tx + cluster(FARMID), data=lockcow)
mm0 %&gt;% tidy(exp=T) %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.9983655"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt;10%</p>
<p><br> <br></p>
<p>Step 6d: Remove PeakSCC</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(CM2TAR, CM2) ~ Parity + SCCDO + CM1 + Tx + cluster(FARMID), data=lockcow)
mm0 %&gt;% tidy(exp=T) %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.9952734"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt;10%</p>
<p><br> <br></p>
<p>Step 6e: Remove DOSCC</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(CM2TAR, CM2) ~ Parity + CM1 + Tx + cluster(FARMID), data=lockcow)
mm0 %&gt;% tidy(exp=T) %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.9986399"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt;10%</p>
<p><br> <br></p>
<p>Step 6e: Remove Parity</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(CM2TAR, CM2) ~ CM1 + Tx + cluster(FARMID), data=lockcow)
mm0 %&gt;% tidy(exp=T) %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"1.00752"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt;10%</p>
<p><br> <br></p>
<p>Step 6e: Remove CM1</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(CM2TAR, CM2) ~ Tx + cluster(FARMID), data=lockcow)
mm0 %&gt;% tidy(exp=T) %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.9803283"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt;10%</p>
<p><br> <br> <br></p>
<div id="revisit-potential-effect-modification-by-parity-when-only-included-in-model-with-treatment" class="section level4">
<h4>Revisit potential effect modification by parity when only included in model with Treatment</h4>
<pre class="r"><code>CoxCM &lt;- coxph(Surv(CM2TAR, CM2) ~ Tx*Parity + cluster(FARMID), data=lockcow)
wald.test(b = coef(CoxCM), Sigma = vcov(CoxCM), Terms = 5:7)</code></pre>
<pre><code>## Wald test:
## ----------
## 
## Chi-squared test:
## X2 = 8.4, df = 3, P(&gt; X2) = 0.038</code></pre>
<p>P &lt; 0.05.</p>
<p>Will stratify analysis</p>
<pre class="r"><code>library(emmeans)
CoxCM &lt;- coxph(Surv(CM2TAR, CM2) ~ Tx*Parity + cluster(FARMID), data=lockcow)
emmeans(CoxCM,pairwise ~ Tx | Parity, type = &quot;response&quot;)</code></pre>
<pre><code>## $emmeans
## Parity = 1:
##  Tx       response     SE df asymp.LCL asymp.UCL
##  Orbeseal    0.892 0.0875 NA     0.736     1.081
##  Lockout     0.749 0.0798 NA     0.608     0.923
## 
## Parity = 2:
##  Tx       response     SE df asymp.LCL asymp.UCL
##  Orbeseal    1.085 0.1337 NA     0.853     1.382
##  Lockout     1.040 0.1953 NA     0.720     1.503
## 
## Parity = 3:
##  Tx       response     SE df asymp.LCL asymp.UCL
##  Orbeseal    1.132 0.2255 NA     0.767     1.673
##  Lockout     1.826 0.2766 NA     1.357     2.457
## 
## Parity = 4:
##  Tx       response     SE df asymp.LCL asymp.UCL
##  Orbeseal    1.303 0.1620 NA     1.022     1.663
##  Lockout     0.724 0.3915 NA     0.251     2.089
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log scale 
## 
## $contrasts
## Parity = 1:
##  contrast           ratio    SE df z.ratio p.value
##  Orbeseal / Lockout  1.19 0.163 NA  1.282  0.1998 
## 
## Parity = 2:
##  contrast           ratio    SE df z.ratio p.value
##  Orbeseal / Lockout  1.04 0.206 NA  0.214  0.8308 
## 
## Parity = 3:
##  contrast           ratio    SE df z.ratio p.value
##  Orbeseal / Lockout  0.62 0.202 NA -1.466  0.1427 
## 
## Parity = 4:
##  contrast           ratio    SE df z.ratio p.value
##  Orbeseal / Lockout  1.80 0.956 NA  1.108  0.2677 
## 
## Tests are performed on the log scale</code></pre>
<p>Note that ratios are inverted. These findings indicate that the hazard ratio within parity=3 cows is different to the others. All stratified effect estimates (HR) have wide confidence intervals that greatly overlap one-another. Also, there appears to be little biologic explanation for why parity 3 cows behave differently to the others. This may be a spurious finding.</p>
<p>Decision: Report main effects.</p>
</div>
</div>
<div id="step-7a-reporting-final-cox-model-for-clinical-mastitis-1-100-dim" class="section level3">
<h3>Step 7a: Reporting final cox model for clinical mastitis (1-100 DIM)</h3>
<p>No covariates included, as no evidence for confounding.</p>
<pre class="r"><code>CoxCM &lt;- coxph(Surv(CM2TAR, CM2) ~ Tx + cluster(FARMID), data=lockcow)
CoxCM %&gt;% tidy(exp=T)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["robust.se"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.9803283","3":"0.1591131","4":"0.09019603","5":"-0.2202733","6":"0.8256583","7":"0.8214791","8":"1.169894"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div id="checking-schoenfield-residuals-for-tx-in-final-model" class="section level4">
<h4>Checking Schoenfield residuals for Tx in final model</h4>
<pre class="r"><code>cox.zph(CoxCM)</code></pre>
<pre><code>##              rho  chisq     p
## TxLockout 0.0256 0.0333 0.855</code></pre>
<pre class="r"><code>SR &lt;- cox.zph(CoxCM)
ggcoxzph(SR,var = c(&quot;TxLockout&quot;))</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
</div>
</div>
</div>
</div>
<div id="outcome-2-culling-or-death" class="section level1">
<h1>Outcome 2: Culling or death</h1>
<div id="d-culling-or-death-risk" class="section level2">
<h2>100 d Culling or death risk</h2>
<pre class="r"><code>CrossTable(lockcow$Tx,lockcow$Rem2,prop.c=FALSE,prop.t=FALSE,prop.chisq = FALSE)</code></pre>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## |           N / Row Total |
## |-------------------------|
## 
##  
## Total Observations in Table:  834 
## 
##  
##              | lockcow$Rem2 
##   lockcow$Tx |         0 |         1 | Row Total | 
## -------------|-----------|-----------|-----------|
##     Orbeseal |       370 |        45 |       415 | 
##              |     0.892 |     0.108 |     0.498 | 
## -------------|-----------|-----------|-----------|
##      Lockout |       376 |        43 |       419 | 
##              |     0.897 |     0.103 |     0.502 | 
## -------------|-----------|-----------|-----------|
## Column Total |       746 |        88 |       834 | 
## -------------|-----------|-----------|-----------|
## 
## </code></pre>
</div>
<div id="kaplan-meier-curve-log-rank-test-for-culling-or-death" class="section level2">
<h2>Kaplan Meier curve &amp; log rank test for culling or death</h2>
<p>Kaplan Meier curve</p>
<pre class="r"><code>library(ggplot2)
library(survminer)
KM &lt;- survfit(Surv(Rem2TAR, Rem2) ~ Tx, data = lockcow)

#knitr::opts_chunk$set(fig.width = 800, fig.height = 900)
ggsurvplot(KM, data = lockcow,  title = &quot;&quot;, pval = T, conf.int = F,risk.table.col = &quot;Tx&quot;,risk.table = T, risk.table.y.text.col = TRUE , surv.plot.height = 5, legend.labs = c(&quot;Orbeseal&quot;,&quot;Lockout&quot;), tables.theme = theme_cleantable(), ggtheme = theme_bw(base_family = &quot;Times&quot;), palette = &quot;Set1&quot;)</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
</div>
<div id="log-rank-test-1" class="section level2">
<h2>Log-Rank test</h2>
<pre class="r"><code>survdiff(Surv(Rem2TAR, Rem2) ~ Tx,data=lockcow,rho=0)</code></pre>
<pre><code>## Call:
## survdiff(formula = Surv(Rem2TAR, Rem2) ~ Tx, data = lockcow, 
##     rho = 0)
## 
##               N Observed Expected (O-E)^2/E (O-E)^2/V
## Tx=Orbeseal 415       45     43.7    0.0394    0.0784
## Tx=Lockout  419       43     44.3    0.0388    0.0784
## 
##  Chisq= 0.1  on 1 degrees of freedom, p= 0.8</code></pre>
</div>
<div id="cox-proportional-hazards-regression-for-culling-or-death-1-100-dim" class="section level2">
<h2>Cox proportional hazards regression for culling or death (1-100 DIM)</h2>
</div>
<div id="model-building-plan-1" class="section level2">
<h2>Model building plan</h2>
<p>Model type: Cox proportional hazards analysis with farm included as a cluster variable (robust sandwich standard error estimator) to account for lack of indepedence.</p>
<p>Step 1: Identify potential confouders using a directed acyclic graph (DAG)</p>
<p>Step 2: Identify correlated variables using pearson and kendalls correlation coefficients</p>
<p>Step 3: Create model with all potential confounders</p>
<p>Step 4: Investigate if covariates meet proportional hazards assumption</p>
<p>Step 5: Investigate potential effect measure modification</p>
<p>Step 6: Remove unneccesary covariates in backwards stepwise fashion using 10% rule (i.e. if hazard ratio for algorithm or culture changes by &gt;10% after removing the covariate, the covariate is retained in the model)</p>
<p>Step 7: Report final model</p>
<div id="step-1-dag-for-culling-or-death" class="section level3">
<h3>Step 1: DAG for culling or death</h3>
<p>This is used to identify variables that could be confounders if they are not balanced between treatment groups.</p>
<pre class="r"><code>library(DiagrammeR)
mermaid(&quot;graph LR
        T(Treatment)--&gt;U(Culling or death)
        A(Age)--&gt;T
        P(Parity)--&gt;T
        M(Yield at dry-off)--&gt;T
        S(SCC during prev lactation)--&gt;T
        C(CM in prev lact)--&gt;T
        D(DIM at dry-off)--&gt; T
        P--&gt;D
        D--&gt;M
        D--&gt;U
        C--&gt;D
        A--&gt;U
        P--&gt;U
        M--&gt;U
        S--&gt;U
        C--&gt;U
        C--&gt;M
        P--&gt;C
        P--&gt;S
        P--&gt;M
        A--&gt;P
        A--&gt;C
        A--&gt;S
        A--&gt;M
        M--&gt;S
        C--&gt;S
        style A fill:#FFFFFF, stroke-width:0px
        style D fill:#FFFFFF, stroke-width:0px
        style T fill:#FFFFFF, stroke-width:2px
        style P fill:#FFFFFF, stroke-width:0px
        style M fill:#FFFFFF, stroke-width:0px
        style S fill:#FFFFFF, stroke-width:0px
        style C fill:#FFFFFF, stroke-width:0px
        style I fill:#FFFFFF, stroke-width:0px
        style U fill:#FFFFFF, stroke-width:2px
        &quot;)</code></pre>
<p><div id="htmlwidget-9f02737998bc537d8ffb" style="width:960px;height:480px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-9f02737998bc537d8ffb">{"x":{"diagram":"graph LR\n        T(Treatment)-->U(Culling or death)\n        A(Age)-->T\n        P(Parity)-->T\n        M(Yield at dry-off)-->T\n        S(SCC during prev lactation)-->T\n        C(CM in prev lact)-->T\n        D(DIM at dry-off)--> T\n        P-->D\n        D-->M\n        D-->U\n        C-->D\n        A-->U\n        P-->U\n        M-->U\n        S-->U\n        C-->U\n        C-->M\n        P-->C\n        P-->S\n        P-->M\n        A-->P\n        A-->C\n        A-->S\n        A-->M\n        M-->S\n        C-->S\n        style A fill:#FFFFFF, stroke-width:0px\n        style D fill:#FFFFFF, stroke-width:0px\n        style T fill:#FFFFFF, stroke-width:2px\n        style P fill:#FFFFFF, stroke-width:0px\n        style M fill:#FFFFFF, stroke-width:0px\n        style S fill:#FFFFFF, stroke-width:0px\n        style C fill:#FFFFFF, stroke-width:0px\n        style I fill:#FFFFFF, stroke-width:0px\n        style U fill:#FFFFFF, stroke-width:2px\n        "},"evals":[],"jsHooks":[]}</script> According to this DAG, I may need to control for the following variables.</p>
<p>Parity [“Parity”]</p>
<p>Age [“Age”]</p>
<p>Yield at most recent test before dry off [“DOMY”]</p>
<p>Somatic cell count at last herd test during previous lactation [“DOSCC” and “PeakSCC”]</p>
<p>Clinical mastitis in previous lactation [“CM2”]</p>
<p>DIM at dry-off [“DODIM”]</p>
<p><br> <br> <br> <br></p>
</div>
<div id="step-2-identify-correlated-covariates-1" class="section level3">
<h3>Step 2: Identify correlated covariates</h3>
<p>Age and Parity highly correlated as shown earlier. Will only offer parity.</p>
<p><br> <br> <br> <br></p>
</div>
<div id="step-3-create-model-with-all-potential-covariates-1" class="section level3">
<h3>Step 3: Create model with all potential covariates</h3>
<p>Cox proportional hazards regression for culling or death (1-100 DIM)</p>
<p>Cows that did not calve or that had long/short dry periods are excluded.</p>
<p>Reasons for R censor = 100 DIM</p>
<pre class="r"><code>library(broom)
library(survival)
SR &lt;- coxph(Surv(Rem2TAR, Rem2) ~ Parity + DIMDO + MYDO + SCCDO + CM1 + PeakSCC + Tx + cluster(FARMID), data=lockcow)
SR %&gt;% tidy(exp=TRUE)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["robust.se"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"Parity2","2":"1.5021265","3":"0.29974610","4":"0.0533576661","5":"7.6255538","6":"2.429890e-14","7":"1.3529706","8":"1.6677257"},{"1":"Parity3","2":"2.7008193","3":"0.29760298","4":"0.2510385278","5":"3.9577796","6":"7.564970e-05","7":"1.6512436","8":"4.4175341"},{"1":"Parity4","2":"2.3266285","3":"0.36543700","4":"0.2114322312","5":"3.9938103","6":"6.501989e-05","7":"1.5372893","8":"3.5212632"},{"1":"DIMDO","2":"1.0030776","3":"0.00102566","4":"0.0004686736","5":"6.5564590","6":"5.510045e-11","7":"1.0021566","8":"1.0039994"},{"1":"MYDO","2":"0.9770310","3":"0.01276378","4":"0.0085344365","5":"-2.7227161","6":"6.474768e-03","7":"0.9608240","8":"0.9935115"},{"1":"SCCDO","2":"1.0221280","3":"0.09934213","4":"0.0717489206","5":"0.3050462","6":"7.603310e-01","7":"0.8880399","8":"1.1764625"},{"1":"CM11","2":"1.2594947","3":"0.24484534","4":"0.1627123655","5":"1.4179045","6":"1.562186e-01","7":"0.9155779","8":"1.7325962"},{"1":"PeakSCC","2":"1.0400111","3":"0.10372615","4":"0.0974299961","5":"0.4026627","6":"6.871964e-01","7":"0.8592221","8":"1.2588401"},{"1":"TxLockout","2":"0.9209503","3":"0.21526419","4":"0.1592760328","5":"-0.5170219","6":"6.051409e-01","7":"0.6740005","8":"1.2583811"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="step-4-schoenfield-tests-to-assess-assumption-of-proportional-hazards-for-explanatory-variables.-1" class="section level3">
<h3>Step 4: Schoenfield tests to assess assumption of proportional hazards for explanatory variables.</h3>
<p>All variables are P &gt; 0.05 for the schoenfeld test.</p>
<pre class="r"><code>SR &lt;- cox.zph(SR)
SR</code></pre>
<pre><code>##               rho chisq     p
## Parity2    0.1825 0.828 0.363
## Parity3    0.0958 1.754 0.185
## Parity4    0.0752 0.868 0.352
## DIMDO     -0.0525 0.371 0.543
## MYDO       0.0340 0.215 0.643
## SCCDO     -0.0634 0.844 0.358
## CM11      -0.0276 0.068 0.794
## PeakSCC    0.0344 0.182 0.670
## TxLockout  0.0732 1.049 0.306
## GLOBAL         NA 2.351 0.985</code></pre>
<p><br> <br> <br> <br></p>
<p>Schoenfield residual plots to assess assumption of proportional hazards.</p>
<pre class="r"><code>ggcoxzph(SR,var = c(&quot;TxLockout&quot;))</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<pre class="r"><code>ggcoxzph(SR,var = c(&quot;DIMDO&quot;,&quot;MYDO&quot;))</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<pre class="r"><code>ggcoxzph(SR,var = c(&quot;SCCDO&quot;,&quot;PeakSCC&quot;))</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<pre class="r"><code>ggcoxzph(SR,var = c(&quot;Parity2&quot;,&quot;Parity3&quot;,&quot;Parity4&quot;))</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<pre class="r"><code>ggcoxzph(SR,var = c(&quot;CM11&quot;))</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<p>No evidence of time-varying effects on CM hazards for all predictors.</p>
<p><br> <br> <br></p>
</div>
<div id="step-5-investigate-effect-measure-modification-1" class="section level3">
<h3>Step 5: Investigate effect measure modification</h3>
<p>Step 5a: Treatment x Farm interaction (farmid modelled as fixed effect to explore this)</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Rem2TAR, Rem2) ~ Parity + MYDO + DIMDO + SCCDO + CM1 + PeakSCC + Tx*factor(FARMID), data=lockcow)
mm0 %&gt;% tidy(exp=TRUE)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"Parity2","2":"1.3765099","3":"0.303508225","4":"1.0528586","5":"0.292405804","6":"0.7593337","7":"2.4953186"},{"1":"Parity3","2":"2.2421598","3":"0.306905497","4":"2.6309062","5":"0.008515753","6":"1.2286498","7":"4.0917113"},{"1":"Parity4","2":"2.1672241","3":"0.368774199","4":"2.0973461","5":"0.035962950","6":"1.0519683","7":"4.4648306"},{"1":"MYDO","2":"0.9499346","3":"0.015951897","4":"-3.2198138","5":"0.001282739","6":"0.9206942","7":"0.9801036"},{"1":"DIMDO","2":"1.0033014","3":"0.001170377","4":"2.8161280","5":"0.004860630","6":"1.0010025","7":"1.0056055"},{"1":"SCCDO","2":"0.9657694","3":"0.103407577","4":"-0.3368245","5":"0.736249214","6":"0.7885927","7":"1.1827532"},{"1":"CM11","2":"1.1548115","3":"0.255070401","4":"0.5643036","5":"0.572547536","6":"0.7004785","7":"1.9038268"},{"1":"PeakSCC","2":"1.0444184","3":"0.104758522","4":"0.4148601","5":"0.678244319","6":"0.8505579","7":"1.2824638"},{"1":"TxLockout","2":"0.8590299","3":"0.514599208","4":"-0.2952814","5":"0.767778923","6":"0.3133146","7":"2.3552440"},{"1":"factor(FARMID)2","2":"1.1728179","3":"0.817358398","4":"0.1950298","5":"0.845369588","6":"0.2363164","7":"5.8205939"},{"1":"factor(FARMID)3","2":"2.4512612","3":"0.492431966","4":"1.8207645","5":"0.068642658","6":"0.9337503","7":"6.4349983"},{"1":"factor(FARMID)4","2":"2.8556602","3":"0.515673562","4":"2.0348204","5":"0.041868949","6":"1.0393562","7":"7.8460066"},{"1":"factor(FARMID)5","2":"1.8884059","3":"0.523936085","4":"1.2133790","5":"0.224984967","6":"0.6762700","7":"5.2731551"},{"1":"TxLockout:factor(FARMID)2","2":"1.6567546","3":"1.049248977","4":"0.4811638","5":"0.630400073","6":"0.2119024","7":"12.9533035"},{"1":"TxLockout:factor(FARMID)3","2":"1.4121250","3":"0.614087118","4":"0.5619653","5":"0.574139631","6":"0.4238003","7":"4.7052754"},{"1":"TxLockout:factor(FARMID)4","2":"0.8037633","3":"0.730981691","4":"-0.2988453","5":"0.765058066","6":"0.1918295","7":"3.3677583"},{"1":"TxLockout:factor(FARMID)5","2":"0.7238778","3":"0.770892228","4":"-0.4191672","5":"0.675093940","6":"0.1597646","7":"3.2798191"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>mm0</code></pre>
<pre><code>## Call:
## coxph(formula = Surv(Rem2TAR, Rem2) ~ Parity + MYDO + DIMDO + 
##     SCCDO + CM1 + PeakSCC + Tx * factor(FARMID), data = lockcow)
## 
##                                coef exp(coef)  se(coef)      z       p
## Parity2                    0.319551  1.376510  0.303508  1.053 0.29241
## Parity3                    0.807440  2.242160  0.306905  2.631 0.00852
## Parity4                    0.773447  2.167224  0.368774  2.097 0.03596
## MYDO                      -0.051362  0.949935  0.015952 -3.220 0.00128
## DIMDO                      0.003296  1.003301  0.001170  2.816 0.00486
## SCCDO                     -0.034830  0.965769  0.103408 -0.337 0.73625
## CM11                       0.143937  1.154812  0.255070  0.564 0.57255
## PeakSCC                    0.043460  1.044418  0.104759  0.415 0.67824
## TxLockout                 -0.151952  0.859030  0.514599 -0.295 0.76778
## factor(FARMID)2            0.159409  1.172818  0.817358  0.195 0.84537
## factor(FARMID)3            0.896603  2.451261  0.492432  1.821 0.06864
## factor(FARMID)4            1.049303  2.855660  0.515674  2.035 0.04187
## factor(FARMID)5            0.635733  1.888406  0.523936  1.213 0.22498
## TxLockout:factor(FARMID)2  0.504861  1.656755  1.049249  0.481 0.63040
## TxLockout:factor(FARMID)3  0.345096  1.412125  0.614087  0.562 0.57414
## TxLockout:factor(FARMID)4 -0.218450  0.803763  0.730982 -0.299 0.76506
## TxLockout:factor(FARMID)5 -0.323133  0.723878  0.770892 -0.419 0.67509
## 
## Likelihood ratio test=48.65  on 17 df, p=6.822e-05
## n= 834, number of events= 88</code></pre>
<p><br> <br> <br> <br></p>
<p>Wald test</p>
<pre class="r"><code>library(aod)
wald.test(b = coef(mm0), Sigma = vcov(mm0), Terms = 14:17)</code></pre>
<pre><code>## Wald test:
## ----------
## 
## Chi-squared test:
## X2 = 1.7, df = 4, P(&gt; X2) = 0.79</code></pre>
<p>Wald test for interaction is p &gt; 0.05. No treatment by herd interaction.</p>
<p><br> <br> <br></p>
<p>Step 5b: Treatment x milk yield at dry-off</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Rem2TAR, Rem2) ~ Parity + DIMDO + SCCDO + PeakSCC + Tx*MYDO + CM1 + cluster(FARMID), data=lockcow)
mm0 %&gt;% tidy</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["robust.se"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"Parity2","2":"0.408958136","3":"0.299763607","4":"0.0530156735","5":"7.7139100","6":"1.220205e-14","7":"0.305049325","8":"0.512866947"},{"1":"Parity3","2":"0.994965681","3":"0.297664143","4":"0.2514390045","5":"3.9570857","6":"7.586973e-05","7":"0.502154288","8":"1.487777075"},{"1":"Parity4","2":"0.843549954","3":"0.365366609","4":"0.2098264312","5":"4.0202273","6":"5.814201e-05","7":"0.432297705","8":"1.254802202"},{"1":"DIMDO","2":"0.003009196","3":"0.001036804","4":"0.0005459837","5":"5.5115114","6":"3.557653e-08","7":"0.001939087","8":"0.004079304"},{"1":"SCCDO","2":"0.018907859","3":"0.099826176","4":"0.0739947679","5":"0.2555297","6":"7.983140e-01","7":"-0.126119221","8":"0.163934939"},{"1":"PeakSCC","2":"0.041488448","3":"0.104004838","4":"0.0992151197","5":"0.4181666","6":"6.758253e-01","7":"-0.152969613","8":"0.235946510"},{"1":"TxLockout","2":"0.130210649","3":"0.597336570","4":"0.3454679692","5":"0.3769109","6":"7.062398e-01","7":"-0.546894128","8":"0.807315427"},{"1":"MYDO","2":"-0.018730767","3":"0.017385197","4":"0.0103335718","5":"-1.8126130","6":"6.989153e-02","7":"-0.038984196","8":"0.001522662"},{"1":"CM11","2":"0.233094101","3":"0.245040770","4":"0.1583693693","5":"1.4718383","6":"1.410646e-01","7":"-0.077304159","8":"0.543492361"},{"1":"TxLockout:MYDO","2":"-0.009347685","3":"0.024506740","4":"0.0156230401","5":"-0.5983269","6":"5.496219e-01","7":"-0.039968281","8":"0.021272911"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>p &gt; 0.05. Will not explore this effect modification further <br> <br> <br> <br></p>
<p>Step 5c: Treatment x Parity at dry-off</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Rem2TAR, Rem2) ~ DIMDO + SCCDO + PeakSCC + Tx*factor(Parity) + MYDO + CM1 + cluster(FARMID), data=lockcow)
mm0 %&gt;% tidy</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["robust.se"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"DIMDO","2":"0.00302502","3":"0.001031365","4":"0.0004409142","5":"6.8607914","6":"6.848010e-12","7":"0.002160844","8":"0.003889196"},{"1":"SCCDO","2":"0.01959633","3":"0.099926443","4":"0.0785417663","5":"0.2495020","6":"8.029725e-01","7":"-0.134342702","8":"0.173535365"},{"1":"PeakSCC","2":"0.04275093","3":"0.104049476","4":"0.0972938933","5":"0.4393999","6":"6.603718e-01","7":"-0.147941601","8":"0.233443453"},{"1":"TxLockout","2":"0.04628291","3":"0.437608952","4":"0.4610281314","5":"0.1003906","6":"9.200342e-01","7":"-0.857315621","8":"0.949881445"},{"1":"factor(Parity)2","2":"0.44108930","3":"0.431870781","4":"0.1541894535","5":"2.8606969","6":"4.227109e-03","7":"0.138883523","8":"0.743295075"},{"1":"factor(Parity)3","2":"1.04502484","3":"0.422275294","4":"0.4637615645","5":"2.2533666","6":"2.423604e-02","7":"0.136068878","8":"1.953980805"},{"1":"factor(Parity)4","2":"1.05797497","3":"0.468884396","4":"0.5213116390","5":"2.0294482","6":"4.241266e-02","7":"0.036222934","8":"2.079727008"},{"1":"MYDO","2":"-0.02340218","3":"0.012786379","4":"0.0086318133","5":"-2.7111550","6":"6.704927e-03","7":"-0.040320227","8":"-0.006484141"},{"1":"CM11","2":"0.22518263","3":"0.245744618","4":"0.1526982692","5":"1.4746901","6":"1.402959e-01","7":"-0.074100475","8":"0.524465741"},{"1":"TxLockout:factor(Parity)2","2":"-0.06844493","3":"0.593600555","4":"0.3304637311","5":"-0.2071178","6":"8.359178e-01","7":"-0.716141945","8":"0.579252077"},{"1":"TxLockout:factor(Parity)3","2":"-0.09968270","3":"0.575655520","4":"0.4196503186","5":"-0.2375375","6":"8.122398e-01","7":"-0.922182212","8":"0.722816809"},{"1":"TxLockout:factor(Parity)4","2":"-0.54925998","3":"0.743728061","4":"0.7758279708","5":"-0.7079662","6":"4.789662e-01","7":"-2.069854860","8":"0.971334902"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Wald test</p>
<pre class="r"><code>library(aod)
wald.test(b = coef(mm0), Sigma = vcov(mm0), Terms = 10:12)</code></pre>
<pre><code>## Wald test:
## ----------
## 
## Chi-squared test:
## X2 = 4.8, df = 3, P(&gt; X2) = 0.18</code></pre>
<p>P &gt; 0.05, will not explore this potential effect modification further</p>
</div>
<div id="step-6-remove-unnecessary-covariates-backwards-selection-using-10-rule-1" class="section level3">
<h3>Step 6: Remove unnecessary covariates (backwards selection using 10% rule)</h3>
<p>The order for removing covariates will be in increasing likelihood of being a confounder, which is based on my knowledge about the variables and their distribution in treatment groups.</p>
<p>This order will be: PeakSCC, DOSCC, CM1, DIMDO, DOMY, Parity</p>
<p>Step 6a: Full model</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Rem2TAR, Rem2) ~ Parity + DIMDO + MYDO + SCCDO + CM1 + PeakSCC + Tx + cluster(FARMID), data=lockcow)
mm0 %&gt;% tidy(exp=T) %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.9209503"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt; 10%. Stays out</p>
<p><br> <br> <br></p>
<p>Step 6b: Removed PeakSCC</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Rem2TAR, Rem2) ~ Parity + DIMDO + MYDO + SCCDO + CM1 + Tx + cluster(FARMID), data=lockcow)
mm0 %&gt;% tidy(exp=T) %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.9247619"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt; 10%. Stays out</p>
<p><br> <br> <br></p>
<p>Step 6c: Removed DOSCC</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Rem2TAR, Rem2) ~ Parity + DIMDO + MYDO + CM1 + Tx + cluster(FARMID), data=lockcow)
mm0 %&gt;% tidy(exp=T) %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.9264109"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt; 10%. Stays out <br> <br> <br></p>
<p>Step 6d: Removed CM1</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Rem2TAR, Rem2) ~ Parity + DIMDO + MYDO + Tx + cluster(FARMID), data=lockcow)
mm0 %&gt;% tidy(exp=T) %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.9320666"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt; 10%. Stays out <br> <br> <br></p>
<p>Step 6e: Removed DIMDO</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Rem2TAR, Rem2) ~ Parity + MYDO + Tx + cluster(FARMID), data=lockcow)
mm0 %&gt;% tidy(exp=T) %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.9630218"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt; 10%. Stays out <br> <br> <br></p>
<p>Step 6f: Removed DOMY</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Rem2TAR, Rem2) ~ Parity + Tx + cluster(FARMID), data=lockcow)
mm0 %&gt;% tidy(exp=T) %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.9582467"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt; 10%. Stays out <br> <br> <br></p>
<p>Step 6f: Removed Parity</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Rem2TAR, Rem2) ~ Tx + cluster(FARMID), data=lockcow)
mm0 %&gt;% tidy(exp=T) %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.9420105"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt; 10%. Stays out</p>
<p><br> <br> <br></p>
</div>
<div id="step-7a-reporting-final-cox-model-for-culling-or-death-1-100-dim" class="section level3">
<h3>Step 7a: Reporting final cox model for culling or death (1-100 DIM)</h3>
<p>No covariates included, as no evidence for confounding.</p>
<pre class="r"><code>CoxRem &lt;- coxph(Surv(Rem2TAR, Rem2) ~ Tx + cluster(FARMID), data=lockcow)
CoxRem %&gt;% tidy(exp=T)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["robust.se"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.9420105","3":"0.2132563","4":"0.1845269","5":"-0.3237409","6":"0.7461342","7":"0.6561243","8":"1.352463"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div id="checking-schoenfield-residuals-for-tx-in-final-model-1" class="section level4">
<h4>Checking Schoenfield residuals for Tx in final model</h4>
<pre class="r"><code>cox.zph(CoxRem)</code></pre>
<pre><code>##              rho  chisq     p
## TxLockout 0.0241 0.0381 0.845</code></pre>
<pre class="r"><code>SR &lt;- cox.zph(CoxRem)
ggcoxzph(SR,var = c(&quot;TxLockout&quot;))</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
</div>
</div>
</div>
</div>
<div id="changing-datasets-dhi-dataset-with-multiple-rows-per-cow" class="section level1">
<h1>Changing datasets: DHI dataset with multiple rows per cow</h1>
<p>Dataset example</p>
<pre class="r"><code>DHIcheck &lt;- lockcowdhi %&gt;% select(Tx,Cow,FARMID,TestDIMcat20,SCC,MY,Parity,CM1,MYDO,SCCDO)
head(DHIcheck, n=10)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Tx"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["Cow"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["FARMID"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["TestDIMcat20"],"name":[4],"type":["fctr"],"align":["left"]},{"label":["SCC"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["MY"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["Parity"],"name":[7],"type":["fctr"],"align":["left"]},{"label":["CM1"],"name":[8],"type":["fctr"],"align":["left"]},{"label":["MYDO"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["SCCDO"],"name":[10],"type":["dbl"],"align":["right"]}],"data":[{"1":"Lockout","2":"6.293419","3":"4","4":"0-20","5":"3.637586","6":"49.44153","7":"3","8":"0","9":"29.93707","10":"5.049856","_rn_":"1"},{"1":"Lockout","2":"6.293419","3":"4","4":"41-60","5":"4.174387","6":"69.85317","7":"3","8":"0","9":"29.93707","10":"5.049856","_rn_":"2"},{"1":"Lockout","2":"6.293419","3":"4","4":"61-80","5":"2.397895","6":"68.49239","7":"3","8":"0","9":"29.93707","10":"5.049856","_rn_":"3"},{"1":"Orbeseal","2":"6.329721","3":"5","4":"21-40","5":"2.772589","6":"57.60618","7":"4","8":"1","9":"24.49397","10":"4.430817","_rn_":"4"},{"1":"Orbeseal","2":"6.329721","3":"5","4":"0-20","5":"3.258097","6":"42.63765","7":"4","8":"1","9":"24.49397","10":"4.430817","_rn_":"5"},{"1":"Orbeseal","2":"6.329721","3":"5","4":"61-80","5":"3.258097","6":"16.32931","7":"4","8":"1","9":"24.49397","10":"4.430817","_rn_":"6"},{"1":"Lockout","2":"6.336826","3":"5","4":"21-40","5":"2.833213","6":"42.63765","7":"1","8":"0","9":"19.95805","10":"4.465908","_rn_":"7"},{"1":"Lockout","2":"6.336826","3":"5","4":"81-100","5":"2.890372","6":"54.43104","7":"1","8":"0","9":"19.95805","10":"4.465908","_rn_":"8"},{"1":"Lockout","2":"6.336826","3":"5","4":"41-60","5":"2.772589","6":"49.44153","7":"1","8":"0","9":"19.95805","10":"4.465908","_rn_":"9"},{"1":"Orbeseal","2":"6.472346","3":"5","4":"41-60","5":"3.806662","6":"49.44153","7":"2","8":"1","9":"15.42213","10":"4.691348","_rn_":"10"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br></p>
</div>
<div id="inspect-data-1" class="section level1">
<h1>Inspect data</h1>
<pre class="r"><code>lockcowdhi &lt;- lockcowdhi[!is.na(lockcowdhi$Tx),]
DHIoutcome &lt;- lockcowdhi %&gt;% select(FARMID,Cow,Tx,Age,Parity,SCCDO,MYDO,DIMDO,CM1,PeakSCC,DPlength,MY,SCC)
print(summarytools::dfSummary(DHIoutcome,valid.col=FALSE, graph.magnif=0.8, style=&quot;grid&quot;))</code></pre>
<pre><code>## Data Frame Summary  
##   
## Dimensions: 2479 x 13  
## Duplicates: 4  
## 
## +----+-----------+---------------------------+---------------------+----------------------------------------+---------+
## | No | Variable  | Stats / Values            | Freqs (% of Valid)  | Graph                                  | Missing |
## +====+===========+===========================+=====================+========================================+=========+
## | 1  | FARMID    | Mean (sd) : 2.9 (1.4)     | 1 : 581 (23.4%)     | IIII                                   | 0       |
## |    | [numeric] | min &lt; med &lt; max:          | 2 : 246 ( 9.9%)     | I                                      | (0%)    |
## |    |           | 1 &lt; 3 &lt; 5                 | 3 : 824 (33.2%)     | IIIIII                                 |         |
## |    |           | IQR (CV) : 2 (0.5)        | 4 : 448 (18.1%)     | III                                    |         |
## |    |           |                           | 5 : 380 (15.3%)     | III                                    |         |
## +----+-----------+---------------------------+---------------------+----------------------------------------+---------+
## | 2  | Cow       | Mean (sd) : 9.4 (1.3)     | 795 distinct values |                   :                    | 0       |
## |    | [numeric] | min &lt; med &lt; max:          |                     |       :       : : :                    | (0%)    |
## |    |           | 6.3 &lt; 10.1 &lt; 11.2         |                     |       :       : : :                    |         |
## |    |           | IQR (CV) : 2.3 (0.1)      |                     |     . : :     : : :                    |         |
## |    |           |                           |                     | . . : : : :   : : :                    |         |
## +----+-----------+---------------------------+---------------------+----------------------------------------+---------+
## | 3  | Tx        | 1. Orbeseal               | 1230 (49.6%)        | IIIIIIIII                              | 0       |
## |    | [factor]  | 2. Lockout                | 1249 (50.4%)        | IIIIIIIIII                             | (0%)    |
## +----+-----------+---------------------------+---------------------+----------------------------------------+---------+
## | 4  | Age       | Mean (sd) : 45.6 (15.1)   | 549 distinct values |   :                                    | 0       |
## |    | [numeric] | min &lt; med &lt; max:          |                     |   :                                    | (0%)    |
## |    |           | 17 &lt; 43.6 &lt; 117           |                     |   : .                                  |         |
## |    |           | IQR (CV) : 22.3 (0.3)     |                     |   : : : .                              |         |
## |    |           |                           |                     |   : : : : : .                          |         |
## +----+-----------+---------------------------+---------------------+----------------------------------------+---------+
## | 5  | Parity    | 1. 1                      | 1087 (43.9%)        | IIIIIIII                               | 0       |
## |    | [factor]  | 2. 2                      |  727 (29.3%)        | IIIII                                  | (0%)    |
## |    |           | 3. 3                      |  422 (17.0%)        | III                                    |         |
## |    |           | 4. 4                      |  243 ( 9.8%)        | I                                      |         |
## +----+-----------+---------------------------+---------------------+----------------------------------------+---------+
## | 6  | SCCDO     | Mean (sd) : 4.5 (1.2)     | 324 distinct values |         . :                            | 0       |
## |    | [numeric] | min &lt; med &lt; max:          |                     |         : :                            | (0%)    |
## |    |           | 0 &lt; 4.5 &lt; 8.9             |                     |       . : : .                          |         |
## |    |           | IQR (CV) : 1.5 (0.3)      |                     |       : : : :                          |         |
## |    |           |                           |                     |     . : : : : :                        |         |
## +----+-----------+---------------------------+---------------------+----------------------------------------+---------+
## | 7  | MYDO      | Mean (sd) : 25.4 (9)      | 91 distinct values  |           :                            | 0       |
## |    | [numeric] | min &lt; med &lt; max:          |                     |         . : .                          | (0%)    |
## |    |           | 1.8 &lt; 25.9 &lt; 49           |                     |     : : : : : .                        |         |
## |    |           | IQR (CV) : 14.1 (0.4)     |                     |     : : : : : :                        |         |
## |    |           |                           |                     | . : : : : : : : : .                    |         |
## +----+-----------+---------------------------+---------------------+----------------------------------------+---------+
## | 8  | DIMDO     | Mean (sd) : 327.4 (65.4)  | 191 distinct values | :                                      | 0       |
## |    | [numeric] | min &lt; med &lt; max:          |                     | :                                      | (0%)    |
## |    |           | 256 &lt; 305 &lt; 869           |                     | : .                                    |         |
## |    |           | IQR (CV) : 55 (0.2)       |                     | : :                                    |         |
## |    |           |                           |                     | : : : .                                |         |
## +----+-----------+---------------------------+---------------------+----------------------------------------+---------+
## | 9  | CM1       | 1. 0                      | 1866 (75.3%)        | IIIIIIIIIIIIIII                        | 0       |
## |    | [factor]  | 2. 1                      |  613 (24.7%)        | IIII                                   | (0%)    |
## +----+-----------+---------------------------+---------------------+----------------------------------------+---------+
## | 10 | PeakSCC   | Mean (sd) : 5.7 (1.2)     | 524 distinct values |       :                                | 0       |
## |    | [numeric] | min &lt; med &lt; max:          |                     |       : .                              | (0%)    |
## |    |           | 3 &lt; 5.5 &lt; 9.2             |                     |     : : : :                            |         |
## |    |           | IQR (CV) : 1.7 (0.2)      |                     |   : : : : : : .                        |         |
## |    |           |                           |                     | . : : : : : : : . .                    |         |
## +----+-----------+---------------------------+---------------------+----------------------------------------+---------+
## | 11 | DPlength  | Mean (sd) : 55.3 (8.6)    | 48 distinct values  |       .   :                            | 0       |
## |    | [numeric] | min &lt; med &lt; max:          |                     |       : : :                            | (0%)    |
## |    |           | 30 &lt; 56 &lt; 85              |                     |       : : : .                          |         |
## |    |           | IQR (CV) : 13 (0.2)       |                     |     : : : : :                          |         |
## |    |           |                           |                     |   : : : : : : :                        |         |
## +----+-----------+---------------------------+---------------------+----------------------------------------+---------+
## | 12 | MY        | Mean (sd) : 43.1 (13.3)   | 140 distinct values |           : .                          | 0       |
## |    | [numeric] | min &lt; med &lt; max:          |                     |         . : :                          | (0%)    |
## |    |           | 1.8 &lt; 44 &lt; 82.1           |                     |       : : : :                          |         |
## |    |           | IQR (CV) : 19.1 (0.3)     |                     |     . : : : : .                        |         |
## |    |           |                           |                     |   . : : : : : : .                      |         |
## +----+-----------+---------------------------+---------------------+----------------------------------------+---------+
## | 13 | SCC       | Mean (sd) : 4.1 (1.5)     | 557 distinct values |       :                                | 0       |
## |    | [numeric] | min &lt; med &lt; max:          |                     |       : .                              | (0%)    |
## |    |           | 0 &lt; 3.8 &lt; 9.2             |                     |       : :                              |         |
## |    |           | IQR (CV) : 1.7 (0.4)      |                     |     . : : :                            |         |
## |    |           |                           |                     |     : : : : : . .                      |         |
## +----+-----------+---------------------------+---------------------+----------------------------------------+---------+</code></pre>
<p>Very little missing data. Will do complete case analysis. <br> <br> <br> <br></p>
<div id="assessing-normality-for-continuous-outcome-variables" class="section level2">
<h2>Assessing normality for continuous outcome variables</h2>
<p>Somatic cell count (log x 10,000 cells)</p>
<pre class="r"><code>library(qualityTools)
qualityTools::qqPlot(lockcowdhi$SCC)</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
<pre class="r"><code>hist(log(lockcowdhi$SCC+1))</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-65-1.png" width="672" /> <br> <br> <br> <br></p>
<p>Milk yield (kg)</p>
<pre class="r"><code>qqPlot(lockcowdhi$MY)</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<pre class="r"><code>hist(lockcowdhi$MY)</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-67-1.png" width="672" /> <br> <br> <br> <br></p>
</div>
</div>
<div id="outcome-3-somatic-cell-count" class="section level1">
<h1>Outcome 3: Somatic cell count</h1>
<div id="modelling-plan" class="section level2">
<h2>Modelling plan</h2>
<p>Model type: Linear mixed models, random intercepts for farm and cow will be fitted to account for repeated measures within cows, and clustering of cows within herds</p>
<p>Step 1: Identify potential confouders using a directed acyclic graph (DAG)</p>
<p>Step 2: Identify correlated variables using pearson and kendalls correlation coefficients</p>
<p>Step 3: Create model with all potential confounders</p>
<p>Step 4: Investigate potential effect measure modification</p>
<p>Step 5: Remove unneccesary covariates in backwards stepwise fashion using 10% rule (i.e. if estimated difference in SCC changes by &gt;10% after removing the covariate, the covariate is retained in the model)</p>
<p>Step 6: Report final model</p>
<p>Step 7: Model diagnostics</p>
<div id="step-1-identify-potential-confounders-using-a-dag" class="section level3">
<h3>Step 1 Identify potential confounders using a DAG</h3>
<pre class="r"><code>library(DiagrammeR)
mermaid(&quot;graph LR
        T(Treatment)--&gt;U(SCC)
        A(Age)--&gt;T
        P(Parity)--&gt;T
        M(Yield at dry-off)--&gt;T
        S(SCC during prev lactation)--&gt;T
        C(CM in prev lact)--&gt;T
        D(Days in milk at test)--&gt;U
        K(Days in milk at dry off) --&gt; M
        C--&gt;K
        K--&gt;T
        D--&gt;T
        A--&gt;U
        P--&gt;U
        M--&gt;U
        S--&gt;U
        C--&gt;U
        C--&gt;M
        P--&gt;C
        P--&gt;S
        P--&gt;M
        A--&gt;P
        A--&gt;C
        A--&gt;S
        A--&gt;M
        M--&gt;S
        C--&gt;S
        style K fill:#FFFFFF, stroke-width:0px
        style A fill:#FFFFFF, stroke-width:0px
        style T fill:#FFFFFF, stroke-width:2px
        style P fill:#FFFFFF, stroke-width:0px
        style M fill:#FFFFFF, stroke-width:0px
        style S fill:#FFFFFF, stroke-width:0px
        style C fill:#FFFFFF, stroke-width:0px
        style I fill:#FFFFFF, stroke-width:0px
        style D fill:#FFFFFF, stroke-width:0px
        style U fill:#FFFFFF, stroke-width:2px
        &quot;)</code></pre>
<p><div id="htmlwidget-38d2d691553fbe4cdda4" style="width:960px;height:480px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-38d2d691553fbe4cdda4">{"x":{"diagram":"graph LR\n        T(Treatment)-->U(SCC)\n        A(Age)-->T\n        P(Parity)-->T\n        M(Yield at dry-off)-->T\n        S(SCC during prev lactation)-->T\n        C(CM in prev lact)-->T\n        D(Days in milk at test)-->U\n        K(Days in milk at dry off) --> M\n        C-->K\n        K-->T\n        D-->T\n        A-->U\n        P-->U\n        M-->U\n        S-->U\n        C-->U\n        C-->M\n        P-->C\n        P-->S\n        P-->M\n        A-->P\n        A-->C\n        A-->S\n        A-->M\n        M-->S\n        C-->S\n        style K fill:#FFFFFF, stroke-width:0px\n        style A fill:#FFFFFF, stroke-width:0px\n        style T fill:#FFFFFF, stroke-width:2px\n        style P fill:#FFFFFF, stroke-width:0px\n        style M fill:#FFFFFF, stroke-width:0px\n        style S fill:#FFFFFF, stroke-width:0px\n        style C fill:#FFFFFF, stroke-width:0px\n        style I fill:#FFFFFF, stroke-width:0px\n        style D fill:#FFFFFF, stroke-width:0px\n        style U fill:#FFFFFF, stroke-width:2px\n        "},"evals":[],"jsHooks":[]}</script> According to this DAG, I may need to control for the following variables:</p>
<p>Parity [“Parity”] &lt;- Age not offered as correlated (will confirm)</p>
<p>Yield at most recent test before dry off [“DOMY”]</p>
<p>Somatic cell count during previous lactation [“DOSCC” and “PeakSCC”]</p>
<p>Days in milk at dry-off [“DIMDO”]</p>
<p>Clinical mastitis in previous lactation [“PrevCM”]</p>
<p>Days in milk at herd test (category, 0-20 “10”, 21-40 “30” etc) [“TestDIMcat20”]</p>
<p><br> <br> <br> <br></p>
</div>
<div id="step-2-identify-correlated-covariates-2" class="section level3">
<h3>Step 2: Identify correlated covariates</h3>
<p>Pearson correlation matrix among potential predictors</p>
<pre class="r"><code>cor &lt;- DHIoutcome[, c(4,5,6,7,8,10,11,12,13)]
cor$Parity &lt;- cor$Parity %&gt;% as.numeric
cor &lt;- cor(cor, use = &quot;complete.obs&quot;)
corPlot(cor,numbers=TRUE)</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
<pre class="r"><code>cor &lt;- DHIoutcome[, c(4,5,6,7,8,10,11,12,13)]
cor$Parity &lt;- cor$Parity %&gt;% as.numeric
cor &lt;- cor(cor, use = &quot;complete.obs&quot;, method=&quot;kendal&quot;)
corPlot(cor,numbers=TRUE)</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
<p>Age and Parity highly correlated as expected. Will only offer parity.</p>
<p><br> <br> <br> <br></p>
</div>
<div id="step-3-create-model-with-all-potential-confounders" class="section level3">
<h3>Step 3: Create model with all potential confounders</h3>
<pre class="r"><code>library(lme4)
mm0 &lt;- lmer(SCC ~ Tx + TestDIMcat20 + Parity + SCCDO + PeakSCC + MYDO + CM1 + DIMDO + (1|FARMID/Cow), data=lockcowdhi)
mm0 %&gt;% tidy</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"(Intercept)","2":"3.218435e+00","3":"0.3252436233","4":"9.89545981","5":"fixed"},{"1":"TxLockout","2":"5.542053e-02","3":"0.0760950545","4":"0.72830654","5":"fixed"},{"1":"TestDIMcat2021-40","2":"-5.539494e-01","3":"0.0805293394","4":"-6.87885225","5":"fixed"},{"1":"TestDIMcat2041-60","2":"-4.712194e-01","3":"0.0749787977","4":"-6.28470140","5":"fixed"},{"1":"TestDIMcat2061-80","2":"-3.856106e-01","3":"0.0725537289","4":"-5.31482819","5":"fixed"},{"1":"TestDIMcat2081-100","2":"-3.164006e-01","3":"0.0785219758","4":"-4.02945249","5":"fixed"},{"1":"Parity2","2":"1.775801e-01","3":"0.0926786601","4":"1.91608379","5":"fixed"},{"1":"Parity3","2":"1.901022e-01","3":"0.1113785524","4":"1.70681151","5":"fixed"},{"1":"Parity4","2":"3.490957e-01","3":"0.1388065988","4":"2.51497919","5":"fixed"},{"1":"SCCDO","2":"5.366157e-02","3":"0.0363821030","4":"1.47494407","5":"fixed"},{"1":"PeakSCC","2":"1.352458e-01","3":"0.0376074714","4":"3.59624913","5":"fixed"},{"1":"MYDO","2":"5.368240e-04","3":"0.0044656838","4":"0.12021093","5":"fixed"},{"1":"CM11","2":"2.731838e-01","3":"0.0958888163","4":"2.84896392","5":"fixed"},{"1":"DIMDO","2":"-4.001176e-05","3":"0.0005991697","4":"-0.06677867","5":"fixed"},{"1":"sd_(Intercept).Cow:FARMID","2":"8.540892e-01","3":"NA","4":"NA","5":"Cow:FARMID"},{"1":"sd_(Intercept).FARMID","2":"0.000000e+00","3":"NA","4":"NA","5":"FARMID"},{"1":"sd_Observation.Residual","2":"1.130041e+00","3":"NA","4":"NA","5":"Residual"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br></p>
</div>
<div id="step-4-investigate-effect-measure-modification" class="section level3">
<h3>Step 4: Investigate effect measure modification</h3>
<p>Will investigate with Farm, TestDIMCat and Parity</p>
<p>Tx:FARMID</p>
<pre class="r"><code>mm0 &lt;- lmer(SCC ~ Tx*FARMID + TestDIMcat20 + Parity + SCCDO + PeakSCC + MYDO + CM1 + DIMDO + (1|Cow), data=lockcowdhi)
car::Anova(mm0) %&gt;% tidy</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["statistic"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"Tx","2":"0.12125747","3":"1","4":"7.276746e-01"},{"1":"FARMID","2":"0.97433145","3":"1","4":"3.236023e-01"},{"1":"TestDIMcat20","2":"59.58430757","3":"4","4":"3.547089e-12"},{"1":"Parity","2":"9.92356796","3":"3","4":"1.922713e-02"},{"1":"SCCDO","2":"3.27672308","3":"1","4":"7.026910e-02"},{"1":"PeakSCC","2":"14.00441375","3":"1","4":"1.823820e-04"},{"1":"MYDO","2":"0.44943710","3":"1","4":"5.026024e-01"},{"1":"CM1","2":"5.92734987","3":"1","4":"1.490764e-02"},{"1":"DIMDO","2":"0.06349039","3":"1","4":"8.010619e-01"},{"1":"Tx:FARMID","2":"2.84067410","3":"1","4":"9.190565e-02"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>P &gt; 0.05. Will not investigate this further.</p>
<p><br> <br> <br></p>
<p>Tx:TestDIMCat</p>
<pre class="r"><code>mm0 &lt;- lmer(SCC ~ Tx*TestDIMcat20 + Parity + SCCDO + PeakSCC + MYDO + CM1 + DIMDO + (1|FARMID/Cow), data=lockcowdhi)
car::Anova(mm0) %&gt;% tidy</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["statistic"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"Tx","2":"0.531113022","3":"1","4":"4.661393e-01"},{"1":"TestDIMcat20","2":"60.597706450","3":"4","4":"2.172219e-12"},{"1":"Parity","2":"8.204628200","3":"3","4":"4.196665e-02"},{"1":"SCCDO","2":"2.028666521","3":"1","4":"1.543560e-01"},{"1":"PeakSCC","2":"13.249407810","3":"1","4":"2.726660e-04"},{"1":"MYDO","2":"0.018642386","3":"1","4":"8.913967e-01"},{"1":"CM1","2":"8.068720300","3":"1","4":"4.503591e-03"},{"1":"DIMDO","2":"0.006886209","3":"1","4":"9.338649e-01"},{"1":"Tx:TestDIMcat20","2":"6.340601093","3":"4","4":"1.751150e-01"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>P &gt; 0.05. Will not investigate this further.</p>
<p><br> <br> <br></p>
<p>Tx:Parity</p>
<pre class="r"><code>mm0 &lt;- lmer(SCC ~ Tx*factor(Parity) + TestDIMcat20 + SCCDO + PeakSCC + MYDO + CM1 + DIMDO + (1|FARMID/Cow), data=lockcowdhi)
car::Anova(mm0) %&gt;% tidy</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["statistic"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"Tx","2":"5.311586e-01","3":"1","4":"4.661202e-01"},{"1":"factor(Parity)","2":"8.344178e+00","3":"3","4":"3.940918e-02"},{"1":"TestDIMcat20","2":"6.055099e+01","3":"4","4":"2.221893e-12"},{"1":"SCCDO","2":"2.202503e+00","3":"1","4":"1.377869e-01"},{"1":"PeakSCC","2":"1.233341e+01","3":"1","4":"4.449239e-04"},{"1":"MYDO","2":"3.047075e-02","3":"1","4":"8.614264e-01"},{"1":"CM1","2":"8.725877e+00","3":"1","4":"3.137251e-03"},{"1":"DIMDO","2":"1.640739e-04","3":"1","4":"9.897801e-01"},{"1":"Tx:factor(Parity)","2":"4.352332e+00","3":"3","4":"2.258462e-01"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>P &gt; 0.05. Will not investigate this further.</p>
</div>
<div id="step-5-remove-unneccesary-covariates-in-backwards-stepwise-fashion-using-10-rule" class="section level3">
<h3>Step 5: Remove unneccesary covariates in backwards stepwise fashion using 10% rule</h3>
<p>The order for removing covariates will be in increasing likelihood of being a confounder, which is based on my knowledge about the variables and their distribution in treatment groups.</p>
<p>This order will be: DIMDO, DOMY, Parity, CM1, DOSCC, PeakSCC</p>
<p>TestDIMcat20 will not be removed.</p>
<p>Step 5a: Full model</p>
<pre class="r"><code>mm0 &lt;- lmer(SCC ~ Tx + Parity + TestDIMcat20 + SCCDO + PeakSCC + MYDO + CM1 + DIMDO + (1|FARMID/Cow), data=lockcowdhi)
mm0 %&gt;% tidy(conf.int=T) %&gt;% subset(term==&quot;TxLockout&quot;)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"TxLockout","2":"0.05542053","3":"0.07609505","4":"0.7283065","5":"-0.09372304","6":"0.2045641","7":"fixed"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br></p>
<p>Step 5b: Removed DIMDO</p>
<pre class="r"><code>mm0 &lt;- lmer(SCC ~ Tx + Parity + TestDIMcat20 + SCCDO + PeakSCC + MYDO + CM1 + (1|FARMID/Cow), data=lockcowdhi)
mm0 %&gt;% tidy() %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.05541266"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt;10%. Stays out.</p>
<p><br> <br> <br></p>
<p>Step 5b: Removed MYDO</p>
<pre class="r"><code>mm0 &lt;- lmer(SCC ~ Tx + Parity + TestDIMcat20 + SCCDO + PeakSCC + CM1 + (1|FARMID/Cow), data=lockcowdhi)
mm0 %&gt;% tidy() %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.05563061"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt;10%. Stays out.</p>
<p><br> <br> <br></p>
<p>Step 5c: Removed Parity</p>
<pre class="r"><code>mm0 &lt;- lmer(SCC ~ Tx + TestDIMcat20 + SCCDO + PeakSCC + CM1 + (1|FARMID/Cow), data=lockcowdhi)
mm0 %&gt;% tidy() %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.04706824"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &gt;10%. Stays in.</p>
<p><br> <br> <br></p>
<p>Step 5d: Removed CM1</p>
<pre class="r"><code>mm0 &lt;- lmer(SCC ~ Tx + Parity + TestDIMcat20 + SCCDO + PeakSCC + (1|FARMID/Cow), data=lockcowdhi)
mm0 %&gt;% tidy() %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.04836998"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &gt;10%. Stays in.</p>
<p><br> <br> <br></p>
<p>Step 5e: Removed SCCDO</p>
<pre class="r"><code>mm0 &lt;- lmer(SCC ~ Tx + Parity + TestDIMcat20 +  PeakSCC + CM1 + (1|FARMID/Cow), data=lockcowdhi)
mm0 %&gt;% tidy() %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.05658166"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt;10%. Stays out</p>
<p><br> <br> <br></p>
<p>Step 5e: Removed PeakSCC</p>
<pre class="r"><code>mm0 &lt;- lmer(SCC ~ Tx + Parity + TestDIMcat20 + CM1 + (1|FARMID/Cow), data=lockcowdhi)
mm0 %&gt;% tidy() %&gt;% subset(term==&quot;TxLockout&quot;,select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxLockout","2":"0.07690172"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &gt;10%. Stays in.</p>
<p><br> <br> <br></p>
</div>
<div id="step-6a-final-model" class="section level3">
<h3>Step 6a: Final model</h3>
<pre class="r"><code>mm0 &lt;- lmer(SCC ~ Tx + Parity + TestDIMcat20 + CM1 + PeakSCC + (1|FARMID/Cow), data=lockcowdhi)
mm0 %&gt;% summary</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: 
## SCC ~ Tx + Parity + TestDIMcat20 + CM1 + PeakSCC + (1 | FARMID/Cow)
##    Data: lockcowdhi
## 
## REML criterion at convergence: 8477.7
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -4.5281 -0.5276 -0.1231  0.4384  4.0686 
## 
## Random effects:
##  Groups     Name        Variance Std.Dev.
##  Cow:FARMID (Intercept) 0.7281   0.8533  
##  FARMID     (Intercept) 0.0000   0.0000  
##  Residual               1.2771   1.1301  
## Number of obs: 2479, groups:  Cow:FARMID, 802; FARMID, 5
## 
## Fixed effects:
##                    Estimate Std. Error t value
## (Intercept)         3.31934    0.19530  16.996
## TxLockout           0.05658    0.07603   0.744
## Parity2             0.18880    0.09089   2.077
## Parity3             0.20793    0.10994   1.891
## Parity4             0.37256    0.13742   2.711
## TestDIMcat2021-40  -0.55178    0.08047  -6.857
## TestDIMcat2041-60  -0.46875    0.07496  -6.254
## TestDIMcat2061-80  -0.38467    0.07255  -5.302
## TestDIMcat2081-100 -0.31365    0.07847  -3.997
## CM11                0.27474    0.09482   2.897
## PeakSCC             0.15819    0.03339   4.737
## 
## Correlation of Fixed Effects:
##             (Intr) TxLckt Party2 Party3 Party4 TDIM202 TDIM204 TDIM206
## TxLockout   -0.151                                                    
## Parity2     -0.120  0.001                                             
## Parity3     -0.011  0.010  0.353                                      
## Parity4      0.022  0.051  0.286  0.261                               
## TDIM2021-40 -0.211  0.011 -0.001  0.012  0.003                        
## TDIM2041-60 -0.203 -0.007  0.013  0.019  0.014  0.490                 
## TDIM2061-80 -0.214  0.003  0.005  0.007 -0.002  0.526   0.508         
## TDIM2081-10 -0.221  0.008  0.012  0.018  0.008  0.549   0.507   0.520 
## CM11         0.236  0.033 -0.045 -0.072 -0.052 -0.024  -0.007  -0.012 
## PeakSCC     -0.895 -0.056 -0.070 -0.154 -0.164  0.009   0.003   0.010 
##             TDIM208 CM11  
## TxLockout                 
## Parity2                   
## Parity3                   
## Parity4                   
## TDIM2021-40               
## TDIM2041-60               
## TDIM2061-80               
## TDIM2081-10               
## CM11        -0.025        
## PeakSCC      0.018  -0.348
## convergence code: 0
## boundary (singular) fit: see ?isSingular</code></pre>
<pre class="r"><code>mm0 %&gt;% tidy(conf.int=T)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"(Intercept)","2":"3.31933694","3":"0.19530393","4":"16.9957509","5":"2.93654827","6":"3.7021256","7":"fixed"},{"1":"TxLockout","2":"0.05658166","3":"0.07602939","4":"0.7442077","5":"-0.09243321","6":"0.2055965","7":"fixed"},{"1":"Parity2","2":"0.18880095","3":"0.09088667","4":"2.0773227","5":"0.01066635","6":"0.3669356","7":"fixed"},{"1":"Parity3","2":"0.20793086","3":"0.10994458","4":"1.8912334","5":"-0.00755655","6":"0.4234183","7":"fixed"},{"1":"Parity4","2":"0.37255794","3":"0.13742062","4":"2.7110775","5":"0.10321848","6":"0.6418974","7":"fixed"},{"1":"TestDIMcat2021-40","2":"-0.55178481","3":"0.08046729","4":"-6.8572559","5":"-0.70949781","6":"-0.3940718","7":"fixed"},{"1":"TestDIMcat2041-60","2":"-0.46875343","3":"0.07495567","4":"-6.2537425","5":"-0.61566384","6":"-0.3218430","7":"fixed"},{"1":"TestDIMcat2061-80","2":"-0.38467364","3":"0.07254698","4":"-5.3024074","5":"-0.52686311","6":"-0.2424842","7":"fixed"},{"1":"TestDIMcat2081-100","2":"-0.31364975","3":"0.07847082","4":"-3.9970241","5":"-0.46744973","6":"-0.1598498","7":"fixed"},{"1":"CM11","2":"0.27473515","3":"0.09482022","4":"2.8974320","5":"0.08889093","6":"0.4605794","7":"fixed"},{"1":"PeakSCC","2":"0.15818795","3":"0.03339297","4":"4.7371632","5":"0.09273893","6":"0.2236370","7":"fixed"},{"1":"sd_(Intercept).Cow:FARMID","2":"0.85330329","3":"NA","4":"NA","5":"NA","6":"NA","7":"Cow:FARMID"},{"1":"sd_(Intercept).FARMID","2":"0.00000000","3":"NA","4":"NA","5":"NA","6":"NA","7":"FARMID"},{"1":"sd_Observation.Residual","2":"1.13007184","3":"NA","4":"NA","5":"NA","6":"NA","7":"Residual"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div id="icc-for-scc-1---100-dim" class="section level4">
<h4>ICC for SCC (1 - 100 DIM)</h4>
<pre class="r"><code>mm0 &lt;- lmer(SCC ~ 1 + (1|FARMID/Cow), data=lockcowdhi)
summary(mm0)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: SCC ~ 1 + (1 | FARMID/Cow)
##    Data: lockcowdhi
## 
## REML criterion at convergence: 8571.8
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -4.0638 -0.5379 -0.1368  0.4386  3.9743 
## 
## Random effects:
##  Groups     Name        Variance  Std.Dev. 
##  Cow:FARMID (Intercept) 8.048e-01 0.8970861
##  FARMID     (Intercept) 1.050e-09 0.0000324
##  Residual               1.321e+00 1.1493656
## Number of obs: 2479, groups:  Cow:FARMID, 802; FARMID, 5
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)  4.10659    0.03938   104.3
## convergence code: 0
## boundary (singular) fit: see ?isSingular</code></pre>
<p>ICC (CowID) = 0.38 ICC (FARMID) = 0.0</p>
<p>Most clustering is happening within cow, which is not a suprise given this is longitudinal data.</p>
</div>
</div>
<div id="step-6b-final-model-reported-as-estimated-marginal-means-lsmeans" class="section level3">
<h3>Step 6b: Final model reported as estimated marginal means (~LSmeans)</h3>
<p>Mean logSCC</p>
<pre class="r"><code>mm0 &lt;- lmer(SCC ~ Tx + Parity + TestDIMcat20 + CM1 + PeakSCC + (1|FARMID/Cow), data=lockcowdhi)
emm &lt;- emmeans(mm0, ~Tx) %&gt;% tidy()
emm</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Tx"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"Orbeseal","2":"4.210484","3":"0.06559297","4":"15.60147","5":"4.071144","6":"4.349824"},{"1":"Lockout","2":"4.267066","3":"0.06777680","4":"17.65868","5":"4.124474","6":"4.409657"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="step-6c-final-model-reported-as-back-transformed-estimated-marginal-means-lsmeans" class="section level3">
<h3>Step 6c: Final model reported as back-transformed estimated marginal means (~LSmeans)</h3>
<p>Geometric mean SCC</p>
<pre class="r"><code>mm0 &lt;- lmer(SCC ~ Tx + Parity + TestDIMcat20 + CM1 + PeakSCC + (1|FARMID/Cow), data=lockcowdhi)
emm &lt;- emmeans(mm0, ~Tx) %&gt;% tidy()
emm$SCC &lt;- exp(emm$estimate) 
emm$LCL &lt;- exp(emm$conf.low)
emm$UCL &lt;- exp(emm$conf.high)
#emm$estimate &lt;- NULL
#emm$std.error &lt;- NULL
#emm$conf.low &lt;- NULL
#emm$conf.high &lt;- NULL
#emm$df &lt;- NULL
emm &lt;- emm %&gt;% subset(select=c(Tx,SCC,LCL,UCL))
emm</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Tx"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["SCC"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["LCL"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["UCL"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"Orbeseal","2":"67.38914","3":"58.62398","4":"77.46483"},{"1":"Lockout","2":"71.31206","3":"61.83529","4":"82.24124"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br></p>
<p>Reported as back-transformed estimated marginal means by herd test day, no interaction with test DIM</p>
<pre class="r"><code>windowsFonts(Times=windowsFont(&quot;Times New Roman&quot;))

mm0 &lt;- lmer(SCC ~ Tx + Parity + TestDIMcat20 + CM1 + PeakSCC + (1|FARMID/Cow), data=lockcowdhi)
atx &lt;- table(lockcowdhi$TestDIMcat20)
emm &lt;- emmeans(mm0, ~Tx*TestDIMcat20, at=list(atx)) %&gt;% tidy()
emm$SCC &lt;- exp(emm$estimate)
emm$LCL &lt;- exp(emm$conf.low)
emm$UCL &lt;- exp(emm$conf.high)
emm &lt;- emm %&gt;% subset(select=c(Tx,TestDIMcat20,SCC,LCL,UCL))

curve &lt;- ggplot(emm) + coord_cartesian(ylim = (c(0,130))) + aes(x=TestDIMcat20, y=SCC, group=Tx, colour=Tx) +
  labs(y = &quot;Somatic cell count \n(geometric mean x 1,000 cells/ml)&quot;, x = &quot;Days in milk&quot;) + geom_point(size=3) + geom_ribbon(aes(ymin=emm$LCL, ymax=emm$UCL,colour=Tx,fill=Tx), linetype=0, alpha=0.1) + geom_line(aes(colour=Tx,linetype=Tx),size=1.1) + theme(panel.border = element_rect(colour = &quot;black&quot;, fill=NA, size=1),axis.text=element_text(size=12,family=&quot;Times&quot;),axis.title=element_text(size=14,face=&quot;bold&quot;,family=&quot;Times&quot;),panel.background = element_rect(fill = &quot;white&quot;, colour = &quot;white&quot;,size = 0.5, linetype = &quot;solid&quot;),panel.grid.major = element_line(size = 0.5, linetype = &#39;solid&#39;, colour = &quot;grey&quot;), panel.grid.minor = element_line(size = 0.25, linetype = &#39;solid&#39;,colour = &quot;grey&quot;),legend.position=&quot;bottom&quot;,legend.text = element_text(colour=&quot;black&quot;, size=12,face=&quot;bold&quot;,family=&quot;Times&quot;)) + scale_color_brewer(palette=&quot;Set1&quot;) 
curve</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-86-1.png" width="672" /> <br> <br> <br> <br></p>
<p>Reported as back-transformed estimated marginal means by herd test day, with interaction with test DIM</p>
<pre class="r"><code>mm0 &lt;- lmer(SCC ~ Tx*TestDIMcat20 +Parity + CM1 + PeakSCC + (1|FARMID/Cow), data=lockcowdhi)
atx &lt;- c(10,30,50,70,90,110)
emm &lt;- emmeans(mm0, ~Tx*TestDIMcat20, at=list(atx)) %&gt;% tidy()
emm$SCC &lt;- exp(emm$estimate)
emm$LCL &lt;- exp(emm$conf.low)
emm$UCL &lt;- exp(emm$conf.high)
emm &lt;- emm %&gt;% subset(select=c(Tx,TestDIMcat20,SCC,LCL,UCL))

curve &lt;- ggplot(emm) + coord_cartesian(ylim = (c(0,130))) + aes(x=TestDIMcat20, y=SCC, group=Tx, colour=Tx) +
  labs(y = &quot;Somatic cell count \n(geometric mean x 1,000 cells/ml)&quot;, x = &quot;Days in milk&quot;) + geom_point(size=3) + geom_ribbon(aes(ymin=emm$LCL, ymax=emm$UCL,colour=Tx,fill=Tx), linetype=0, alpha=0.1) + geom_line(aes(colour=Tx,linetype=Tx),size=1.1) + theme(panel.border = element_rect(colour = &quot;black&quot;, fill=NA, size=1),axis.text=element_text(size=12,family=&quot;Times&quot;),axis.title=element_text(size=14,face=&quot;bold&quot;,family=&quot;Times&quot;),panel.background = element_rect(fill = &quot;white&quot;, colour = &quot;white&quot;,size = 0.5, linetype = &quot;solid&quot;),panel.grid.major = element_line(size = 0.5, linetype = &#39;solid&#39;, colour = &quot;grey&quot;), panel.grid.minor = element_line(size = 0.25, linetype = &#39;solid&#39;,colour = &quot;grey&quot;),legend.position=&quot;bottom&quot;,legend.text = element_text(colour=&quot;black&quot;, size=12,face=&quot;bold&quot;,family=&quot;Times&quot;)) + scale_color_brewer(palette=&quot;Set1&quot;) 
curve</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-87-1.png" width="672" /></p>
<p><br> <br> <br> <br></p>
</div>
<div id="step-7-model-diagnostics" class="section level3">
<h3>Step 7: Model diagnostics</h3>
<p>Checking homoskedasticity assumption (variance of residuals)</p>
<pre class="r"><code>mm0 &lt;- lmer(SCC ~ Tx*TestDIMcat20 +Parity + CM1 + PeakSCC + (1|FARMID/Cow), data=lockcowdhi)
ggplot(data.frame(eta=predict(mm0,type=&quot;link&quot;),pearson=residuals(mm0,type=&quot;pearson&quot;)),
       aes(x=eta,y=pearson)) +
  geom_point() +
  theme_bw()</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-88-1.png" width="672" /></p>
<p><br> Variance appears to get slightly larger at higher values on the x-axis shown here. But most values are clustered closely in the middle.</p>
<p>Checking normality of residuals</p>
<pre class="r"><code>qqnorm(residuals(mm0))</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-89-1.png" width="672" /></p>
<p><br> Evidence of small L tail. Although some evidence of heteroskedasticity and not perfectly normal residuals, I believe these are allowable for this model.</p>
</div>
</div>
</div>
<div id="outcome-4-milk-yield-0-100-dim" class="section level1">
<h1>Outcome 4: Milk yield (0-100 DIM)</h1>
<div id="modelling-plan-1" class="section level2">
<h2>Modelling plan</h2>
<p>Model type: Linear mixed models, random intercepts for farm and cow will be fitted to account for repeated measures within cows, and clustering of cows within herds</p>
<p>Step 1: Identify potential confouders using a directed acyclic graph (DAG)</p>
<p>Step 2: Identify correlated variables using pearson and kendalls correlation coefficients (already done)</p>
<p>Step 3: Create model with all potential confounders</p>
<p>Step 4: Investigate potential effect measure modification</p>
<p>Step 5: Remove unneccesary covariates in backwards stepwise fashion using 10% rule (i.e. if estimated difference in SCC changes by &gt;10% after removing the covariate, the covariate is retained in the model)</p>
<p>Step 6: Report final model</p>
<p>Step 7: Model diagnostics</p>
<div id="steps-1-and-2-identify-potential-confounders-using-a-dag" class="section level3">
<h3>Steps 1 and 2: Identify potential confounders using a DAG</h3>
<pre class="r"><code>library(DiagrammeR)
mermaid(&quot;graph LR
        T(Treatment)--&gt;U(Milk yield)
        A(Age)--&gt;T
        P(Parity)--&gt;T
        M(Yield at dry-off)--&gt;T
        S(SCC during prev lactation)--&gt;T
        C(CM in prev lact)--&gt;T
        D(Days in milk at test)--&gt;U
        K(Days in milk at dry off) --&gt; M
        C--&gt;K
        K--&gt;T
        D--&gt;T
        A--&gt;U
        P--&gt;U
        M--&gt;U
        S--&gt;U
        C--&gt;U
        C--&gt;M
        P--&gt;C
        P--&gt;S
        P--&gt;M
        A--&gt;P
        A--&gt;C
        A--&gt;S
        A--&gt;M
        M--&gt;S
        C--&gt;S
        style K fill:#FFFFFF, stroke-width:0px
        style A fill:#FFFFFF, stroke-width:0px
        style T fill:#FFFFFF, stroke-width:2px
        style P fill:#FFFFFF, stroke-width:0px
        style M fill:#FFFFFF, stroke-width:0px
        style S fill:#FFFFFF, stroke-width:0px
        style C fill:#FFFFFF, stroke-width:0px
        style I fill:#FFFFFF, stroke-width:0px
        style D fill:#FFFFFF, stroke-width:0px
        style U fill:#FFFFFF, stroke-width:2px
        &quot;)</code></pre>
<p><div id="htmlwidget-adfdfcda8d946e1dc247" style="width:960px;height:480px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-adfdfcda8d946e1dc247">{"x":{"diagram":"graph LR\n        T(Treatment)-->U(Milk yield)\n        A(Age)-->T\n        P(Parity)-->T\n        M(Yield at dry-off)-->T\n        S(SCC during prev lactation)-->T\n        C(CM in prev lact)-->T\n        D(Days in milk at test)-->U\n        K(Days in milk at dry off) --> M\n        C-->K\n        K-->T\n        D-->T\n        A-->U\n        P-->U\n        M-->U\n        S-->U\n        C-->U\n        C-->M\n        P-->C\n        P-->S\n        P-->M\n        A-->P\n        A-->C\n        A-->S\n        A-->M\n        M-->S\n        C-->S\n        style K fill:#FFFFFF, stroke-width:0px\n        style A fill:#FFFFFF, stroke-width:0px\n        style T fill:#FFFFFF, stroke-width:2px\n        style P fill:#FFFFFF, stroke-width:0px\n        style M fill:#FFFFFF, stroke-width:0px\n        style S fill:#FFFFFF, stroke-width:0px\n        style C fill:#FFFFFF, stroke-width:0px\n        style I fill:#FFFFFF, stroke-width:0px\n        style D fill:#FFFFFF, stroke-width:0px\n        style U fill:#FFFFFF, stroke-width:2px\n        "},"evals":[],"jsHooks":[]}</script> According to this DAG, I may need to control for the following variables:</p>
<p>Parity [“Parity”] &lt;- Age not offered as correlated</p>
<p>Yield at most recent test before dry off [“DOMY”]</p>
<p>Somatic cell count during previous lactation [“DOSCC” and “PeakSCC”]</p>
<p>Days in milk at dry-off [“DIMDO”]</p>
<p>Clinical mastitis in previous lactation [“PrevCM”]</p>
<p>Days in milk at herd test (category, 0-20 “10”, 21-40 “30” etc) [“TestDIMcat20”]</p>
<p><br> <br> <br> <br></p>
</div>
<div id="step-3-create-model-with-all-potential-confounders-1" class="section level3">
<h3>Step 3: Create model with all potential confounders</h3>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + TestDIMcat20 + Parity + SCCDO + PeakSCC + MYDO + CM1 + DIMDO + (1|FARMID/Cow), data=lockcowdhi)
mm0 %&gt;% tidy</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"(Intercept)","2":"20.98424486","3":"4.353599082","4":"4.8199764","5":"fixed"},{"1":"TxLockout","2":"0.33773583","3":"0.499274475","4":"0.6764532","5":"fixed"},{"1":"TestDIMcat2021-40","2":"11.63510773","3":"0.431382093","4":"26.9716985","5":"fixed"},{"1":"TestDIMcat2041-60","2":"12.57436139","3":"0.394903364","4":"31.8416163","5":"fixed"},{"1":"TestDIMcat2061-80","2":"12.60452528","3":"0.381963924","4":"32.9992559","5":"fixed"},{"1":"TestDIMcat2081-100","2":"9.83898722","3":"0.418367797","4":"23.5175539","5":"fixed"},{"1":"Parity2","2":"1.99114618","3":"0.610048829","4":"3.2639128","5":"fixed"},{"1":"Parity3","2":"2.67275503","3":"0.739559875","4":"3.6139806","5":"fixed"},{"1":"Parity4","2":"1.83089660","3":"0.921355349","4":"1.9871775","5":"fixed"},{"1":"SCCDO","2":"0.49225978","3":"0.244638215","4":"2.0121949","5":"fixed"},{"1":"PeakSCC","2":"-0.40617583","3":"0.251381282","4":"-1.6157759","5":"fixed"},{"1":"MYDO","2":"0.27684731","3":"0.039958385","4":"6.9283909","5":"fixed"},{"1":"CM11","2":"0.97273376","3":"0.642059329","4":"1.5150216","5":"fixed"},{"1":"DIMDO","2":"0.01248477","3":"0.003960764","4":"3.1521109","5":"fixed"},{"1":"sd_(Intercept).Cow:FARMID","2":"6.16543621","3":"NA","4":"NA","5":"Cow:FARMID"},{"1":"sd_(Intercept).FARMID","2":"8.14105234","3":"NA","4":"NA","5":"FARMID"},{"1":"sd_Observation.Residual","2":"5.89665836","3":"NA","4":"NA","5":"Residual"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br></p>
</div>
<div id="step-4-investigate-effect-measure-modification-1" class="section level3">
<h3>Step 4: Investigate effect measure modification</h3>
<p>Will investigate EMM with Farm, TestDIMCat and Parity</p>
<p>Tx:FARMID</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx*FARMID + TestDIMcat20 + Parity + SCCDO + PeakSCC + MYDO + CM1 + DIMDO + (1|Cow), data=lockcowdhi)
car::Anova(mm0) %&gt;% tidy</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["statistic"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"Tx","2":"5.538632e-01","3":"1","4":"4.567435e-01"},{"1":"FARMID","2":"4.215000e+02","3":"1","4":"1.150659e-93"},{"1":"TestDIMcat20","2":"1.389220e+03","3":"4","4":"1.503301e-299"},{"1":"Parity","2":"3.423561e+01","3":"3","4":"1.766781e-07"},{"1":"SCCDO","2":"5.478799e+00","3":"1","4":"1.924848e-02"},{"1":"PeakSCC","2":"2.405078e+00","3":"1","4":"1.209421e-01"},{"1":"MYDO","2":"2.074101e+02","3":"1","4":"5.045799e-47"},{"1":"CM1","2":"2.000633e+00","3":"1","4":"1.572335e-01"},{"1":"DIMDO","2":"2.173083e+01","3":"1","4":"3.137089e-06"},{"1":"Tx:FARMID","2":"3.394766e-02","3":"1","4":"8.538182e-01"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>P &gt; 0.05. Will not investigate this further.</p>
<p><br> <br> <br></p>
<p>Tx:TestDIMCat</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx*TestDIMcat20 + Parity + SCCDO + PeakSCC + MYDO + CM1 + DIMDO + (1|FARMID/Cow), data=lockcowdhi)
car::Anova(mm0) %&gt;% tidy</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["statistic"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"Tx","2":"0.4575718","3":"1","4":"4.987610e-01"},{"1":"TestDIMcat20","2":"1434.3509988","3":"4","4":"2.459623e-309"},{"1":"Parity","2":"17.6969394","3":"3","4":"5.079049e-04"},{"1":"SCCDO","2":"4.0880665","3":"1","4":"4.318702e-02"},{"1":"PeakSCC","2":"2.6089955","3":"1","4":"1.062591e-01"},{"1":"MYDO","2":"47.8616943","3":"1","4":"4.573708e-12"},{"1":"CM1","2":"2.2695689","3":"1","4":"1.319366e-01"},{"1":"DIMDO","2":"9.9114047","3":"1","4":"1.642577e-03"},{"1":"Tx:TestDIMcat20","2":"1.3024386","3":"4","4":"8.609617e-01"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>P &gt; 0.05. Will not investigate this further.</p>
<p><br> <br> <br></p>
<p>Tx:Parity</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx*Parity + TestDIMcat20 + SCCDO + PeakSCC + MYDO + CM1 + DIMDO + (1|FARMID/Cow), data=lockcowdhi)
car::Anova(mm0) %&gt;% tidy</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["statistic"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"Tx","2":"0.4568294","3":"1","4":"4.991095e-01"},{"1":"Parity","2":"17.6090569","3":"3","4":"5.295297e-04"},{"1":"TestDIMcat20","2":"1435.2578790","3":"4","4":"1.563926e-309"},{"1":"SCCDO","2":"3.8854065","3":"1","4":"4.870747e-02"},{"1":"PeakSCC","2":"2.4735057","3":"1","4":"1.157794e-01"},{"1":"MYDO","2":"47.6441897","3":"1","4":"5.110347e-12"},{"1":"CM1","2":"2.2604260","3":"1","4":"1.327175e-01"},{"1":"DIMDO","2":"9.4143300","3":"1","4":"2.152962e-03"},{"1":"Tx:Parity","2":"1.7739478","3":"3","4":"6.206205e-01"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>P &gt; 0.05. Will not investigate this further.</p>
<p><br> <br> <br></p>
</div>
<div id="step-5-remove-unneccesary-covariates-in-backwards-stepwise-fashion-using-10-rule-1" class="section level3">
<h3>Step 5: Remove unneccesary covariates in backwards stepwise fashion using 10% rule</h3>
<p>The order for removing covariates will be in increasing likelihood of being a confounder, which is based on my knowledge about the variables and their distribution in treatment groups.</p>
<p>This order will be: DIMDO, CM1, DOSCC, PeakSCC, Parity, DOMY</p>
<p>TestDIMcat20 will not be removed.</p>
<p>Step 5a: Full model</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + Parity + TestDIMcat20 + SCCDO + PeakSCC + MYDO + CM1 + DIMDO + (1|FARMID/Cow), data=lockcowdhi)
mm0 %&gt;% tidy(conf.int=T) %&gt;% subset(term==&quot;TxLockout&quot;)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"TxLockout","2":"0.3377358","3":"0.4992745","4":"0.6764532","5":"-0.6408242","6":"1.316296","7":"fixed"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br></p>
<p>Step 5b: Remove DIMDO</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + Parity + TestDIMcat20 + SCCDO + PeakSCC + MYDO + CM1 + (1|FARMID/Cow), data=lockcowdhi)
mm0 %&gt;% tidy(conf.int=T) %&gt;% subset(term==&quot;TxLockout&quot;)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"TxLockout","2":"0.3389308","3":"0.5022982","4":"0.67476","5":"-0.6455557","6":"1.323417","7":"fixed"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt;10%. Stays out.</p>
<p><br> <br> <br></p>
<p>Step 5c: Remove CM1</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + Parity + TestDIMcat20 + SCCDO + PeakSCC + MYDO + (1|FARMID/Cow), data=lockcowdhi)
mm0 %&gt;% tidy(conf.int=T) %&gt;% subset(term==&quot;TxLockout&quot;)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"TxLockout","2":"0.3102132","3":"0.5024522","4":"0.6173985","5":"-0.6745749","6":"1.295001","7":"fixed"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt;10%. Stays out.</p>
<p><br> <br> <br></p>
<p>Step 5d: Remove DOSCC</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + Parity + TestDIMcat20 + PeakSCC + MYDO + (1|FARMID/Cow), data=lockcowdhi)
mm0 %&gt;% tidy(conf.int=T) %&gt;% subset(term==&quot;TxLockout&quot;)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"TxLockout","2":"0.3202181","3":"0.5034401","4":"0.6360598","5":"-0.6665065","6":"1.306943","7":"fixed"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt;10%. Stays out.</p>
<p><br> <br> <br></p>
<p>Step 5e: Remove PeakSCC</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + Parity + TestDIMcat20 + MYDO + (1|FARMID/Cow), data=lockcowdhi)
mm0 %&gt;% tidy(conf.int=T) %&gt;% subset(term==&quot;TxLockout&quot;)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"TxLockout","2":"0.3184934","3":"0.5024657","4":"0.633861","5":"-0.6663213","6":"1.303308","7":"fixed"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt;10%. Stays out.</p>
<p><br> <br> <br></p>
<p>Step 5f: Remove Parity</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + TestDIMcat20 + MYDO + (1|FARMID/Cow), data=lockcowdhi)
mm0 %&gt;% tidy(conf.int=T) %&gt;% subset(term==&quot;TxLockout&quot;)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"TxLockout","2":"0.3049283","3":"0.5082184","4":"0.5999945","5":"-0.6911615","6":"1.301018","7":"fixed"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt;10%. Stays out.</p>
<p><br> <br> <br></p>
<p>Step 5g: Remove MYDO</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + TestDIMcat20 + (1|FARMID/Cow), data=lockcowdhi)
mm0 %&gt;% tidy(conf.int=T) %&gt;% subset(term==&quot;TxLockout&quot;)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"TxLockout","2":"0.3395652","3":"0.5159738","4":"0.6581054","5":"-0.6717249","6":"1.350855","7":"fixed"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &gt;10%, MYDO Stays in.</p>
</div>
<div id="step-6-final-model" class="section level3">
<h3>Step 6: Final model</h3>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + TestDIMcat20 + MYDO + (1|FARMID/Cow), data=lockcowdhi)
mm0 %&gt;% summary()</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: MY ~ Tx + TestDIMcat20 + MYDO + (1 | FARMID/Cow)
##    Data: lockcowdhi
## 
## REML criterion at convergence: 17060.2
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -5.5761 -0.4397  0.0323  0.4787  3.7281 
## 
## Random effects:
##  Groups     Name        Variance Std.Dev.
##  Cow:FARMID (Intercept) 40.13    6.335   
##  FARMID     (Intercept) 74.47    8.630   
##  Residual               34.74    5.894   
## Number of obs: 2479, groups:  Cow:FARMID, 802; FARMID, 5
## 
## Fixed effects:
##                    Estimate Std. Error t value
## (Intercept)        28.42539    3.99739   7.111
## TxLockout           0.30493    0.50822   0.600
## TestDIMcat2021-40  11.63950    0.43180  26.956
## TestDIMcat2041-60  12.53594    0.39488  31.746
## TestDIMcat2061-80  12.59149    0.38200  32.962
## TestDIMcat2081-100  9.82467    0.41859  23.471
## MYDO                0.19714    0.03743   5.268
## 
## Correlation of Fixed Effects:
##             (Intr) TxLckt TDIM202 TDIM204 TDIM206 TDIM208
## TxLockout   -0.061                                       
## TDIM2021-40 -0.055  0.009                                
## TDIM2041-60 -0.050 -0.005  0.489                         
## TDIM2061-80 -0.051  0.003  0.531   0.505                 
## TDIM2081-10 -0.053  0.007  0.566   0.508   0.522         
## MYDO        -0.234 -0.013  0.007  -0.003  -0.006   0.000</code></pre>
<pre class="r"><code>mm0 %&gt;% tidy(conf.int=T)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"(Intercept)","2":"28.4253888","3":"3.9973892","4":"7.1109885","5":"20.5906499","6":"36.2601276","7":"fixed"},{"1":"TxLockout","2":"0.3049283","3":"0.5082184","4":"0.5999945","5":"-0.6911615","6":"1.3010181","7":"fixed"},{"1":"TestDIMcat2021-40","2":"11.6394994","3":"0.4317995","4":"26.9557964","5":"10.7931879","6":"12.4858108","7":"fixed"},{"1":"TestDIMcat2041-60","2":"12.5359434","3":"0.3948806","4":"31.7461627","5":"11.7619916","6":"13.3098951","7":"fixed"},{"1":"TestDIMcat2061-80","2":"12.5914856","3":"0.3820030","4":"32.9617475","5":"11.8427735","6":"13.3401977","7":"fixed"},{"1":"TestDIMcat2081-100","2":"9.8246680","3":"0.4185943","4":"23.4706214","5":"9.0042383","6":"10.6450977","7":"fixed"},{"1":"MYDO","2":"0.1971435","3":"0.0374251","4":"5.2676821","5":"0.1237917","6":"0.2704954","7":"fixed"},{"1":"sd_(Intercept).Cow:FARMID","2":"6.3345792","3":"NA","4":"NA","5":"NA","6":"NA","7":"Cow:FARMID"},{"1":"sd_(Intercept).FARMID","2":"8.6297659","3":"NA","4":"NA","5":"NA","6":"NA","7":"FARMID"},{"1":"sd_Observation.Residual","2":"5.8940828","3":"NA","4":"NA","5":"NA","6":"NA","7":"Residual"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br></p>
<div id="icc-for-milk-yield-1---100-dim" class="section level4">
<h4>ICC for Milk yield (1 - 100 DIM)</h4>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ 1 + (1|FARMID/Cow), data=lockcowdhi)
summary(mm0)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: MY ~ 1 + (1 | FARMID/Cow)
##    Data: lockcowdhi
## 
## REML criterion at convergence: 18137.8
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -4.1020 -0.4230  0.1139  0.5465  3.3349 
## 
## Random effects:
##  Groups     Name        Variance Std.Dev.
##  Cow:FARMID (Intercept) 34.38    5.863   
##  FARMID     (Intercept) 92.07    9.595   
##  Residual               63.74    7.984   
## Number of obs: 2479, groups:  Cow:FARMID, 802; FARMID, 5
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)   42.941      4.301   9.985</code></pre>
<p>ICC (CowID) = 0.18 ICC (FARMID) = 0.48</p>
<p>A lot of clustering, particularly within farms, which is not suprising given that many milk yield determinants (eg diet) are allocated at the group level.</p>
</div>
</div>
<div id="step-6b-final-model-using-10-rule-reported-as-estimated-marginal-means-lsmeans" class="section level3">
<h3>Step 6b: Final model (using 10% rule) reported as estimated marginal means (~LSmeans)</h3>
<p>Mean logSCC</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + TestDIMcat20 + MYDO + (1|FARMID/Cow), data=lockcowdhi)
emm &lt;- emmeans(mm0, ~Tx) %&gt;% tidy()
emm</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Tx"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"Orbeseal","2":"42.75730","3":"3.877676","4":"4.029594","5":"32.02225","6":"53.49234"},{"1":"Lockout","2":"43.06223","3":"3.877413","4":"4.028503","5":"32.32677","6":"53.79768"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Very large confidence intervals, probably because of the huge amount of within herd clustering and between herd variability.</p>
<p><br> <br> <br></p>
<p>Reported, stratified by TestDIMcat20</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + TestDIMcat20 + MYDO + (1|FARMID/Cow), data=lockcowdhi)

atx &lt;- table(lockcowdhi$TestDIMcat20)
emm &lt;- emmeans(mm0, ~Tx*TestDIMcat20, at=list(atx)) %&gt;% tidy()
emm$MY &lt;- emm$estimate
emm &lt;- emm %&gt;% subset(select=c(Tx,TestDIMcat20,MY,conf.low,conf.high))

curve &lt;- ggplot(emm) + coord_cartesian(ylim = (c(0,60))) + aes(x=TestDIMcat20, y=MY, group=Tx, colour=Tx) + geom_point(size=3) + geom_ribbon(aes(ymin=emm$conf.low, ymax=emm$conf.high,colour=Tx,fill=Tx), linetype=0, alpha=0.1) + geom_line(aes(colour=Tx,linetype=Tx),size=1.1) + theme(panel.border = element_rect(colour = &quot;black&quot;, fill=NA, size=1),legend.position=&quot;bottom&quot;,axis.text=element_text(size=12),axis.title=element_text(size=14,face=&quot;bold&quot;)) +
  labs(y = &quot;Average daily milk yield (kg)&quot;, x = &quot;Days in milk&quot;) + theme(axis.text=element_text(size=12),axis.title=element_text(size=14,face=&quot;bold&quot;,family=&quot;Times&quot;),panel.background = element_rect(fill = &quot;white&quot;, colour = &quot;white&quot;,size = 0.5, linetype = &quot;solid&quot;),panel.grid.major = element_line(size = 0.5, linetype = &#39;solid&#39;, colour = &quot;grey&quot;), panel.grid.minor = element_line(size = 0.25, linetype = &#39;solid&#39;,colour = &quot;grey&quot;),legend.position=&quot;bottom&quot;,legend.text = element_text(family=&quot;Times&quot;, colour=&quot;black&quot;, size=12,face=&quot;bold&quot;)) + scale_color_brewer(palette=&quot;Set1&quot;)
curve</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-105-1.png" width="672" /> <br> <br> <br> <br></p>
<p>Reported, stratified and modified by TestDIMcat20</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx*TestDIMcat20 + MYDO + (1|FARMID/Cow), data=lockcowdhi)
summary(mm0)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: MY ~ Tx * TestDIMcat20 + MYDO + (1 | FARMID/Cow)
##    Data: lockcowdhi
## 
## REML criterion at convergence: 17054.6
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -5.5684 -0.4338  0.0289  0.4858  3.7595 
## 
## Random effects:
##  Groups     Name        Variance Std.Dev.
##  Cow:FARMID (Intercept) 40.13    6.335   
##  FARMID     (Intercept) 74.52    8.633   
##  Residual               34.79    5.898   
## Number of obs: 2479, groups:  Cow:FARMID, 802; FARMID, 5
## 
## Fixed effects:
##                              Estimate Std. Error t value
## (Intercept)                  28.21452    4.00671   7.042
## TxLockout                     0.73553    0.72844   1.010
## TestDIMcat2021-40            11.92319    0.60556  19.689
## TestDIMcat2041-60            12.78029    0.57173  22.354
## TestDIMcat2061-80            13.00016    0.54666  23.781
## TestDIMcat2081-100            9.96476    0.59155  16.845
## MYDO                          0.19673    0.03744   5.254
## TxLockout:TestDIMcat2021-40  -0.55609    0.86119  -0.646
## TxLockout:TestDIMcat2041-60  -0.47569    0.79073  -0.602
## TxLockout:TestDIMcat2061-80  -0.80013    0.76431  -1.047
## TxLockout:TestDIMcat2081-100 -0.26274    0.83604  -0.314
## 
## Correlation of Fixed Effects:
##             (Intr) TxLckt TDIM202 TDIM204 TDIM206 TDIM208 MYDO  
## TxLockout   -0.088                                              
## TDIM2021-40 -0.074  0.417                                       
## TDIM2041-60 -0.071  0.394  0.486                                
## TDIM2061-80 -0.073  0.415  0.545   0.497                        
## TDIM2081-10 -0.074  0.416  0.573   0.506   0.532                
## MYDO        -0.233 -0.019 -0.008  -0.004  -0.011  -0.007        
## TL:TDIM2021  0.049 -0.578 -0.700  -0.341  -0.382  -0.401   0.018
## TL:TDIM2041  0.051 -0.558 -0.350  -0.723  -0.359  -0.365   0.004
## TL:TDIM2061  0.052 -0.577 -0.389  -0.355  -0.715  -0.380   0.010
## TL:TDIM2081  0.051 -0.577 -0.403  -0.357  -0.376  -0.706   0.010
##             TL:TDIM202 TL:TDIM204 TL:TDIM206
## TxLockout                                   
## TDIM2021-40                                 
## TDIM2041-60                                 
## TDIM2061-80                                 
## TDIM2081-10                                 
## MYDO                                        
## TL:TDIM2021                                 
## TL:TDIM2041  0.488                          
## TL:TDIM2061  0.530      0.503               
## TL:TDIM2081  0.563      0.508      0.522</code></pre>
<pre class="r"><code>atx &lt;- table(lockcowdhi$TestDIMcat20)
emm &lt;- emmeans(mm0, ~Tx*TestDIMcat20, at=list(atx)) %&gt;% tidy()
emm$MY &lt;- emm$estimate
emm &lt;- emm %&gt;% subset(select=c(Tx,TestDIMcat20,MY,conf.low,conf.high))
curve &lt;- ggplot(emm) + coord_cartesian(ylim = (c(0,60))) + aes(x=TestDIMcat20, y=MY, group=Tx, colour=Tx) + geom_point(size=3) + geom_ribbon(aes(ymin=emm$conf.low, ymax=emm$conf.high,colour=Tx,fill=Tx), linetype=0, alpha=0.1) + geom_line(aes(colour=Tx,linetype=Tx),size=1.1) + theme(panel.border = element_rect(colour = &quot;black&quot;, fill=NA, size=1),legend.position=&quot;bottom&quot;,axis.text=element_text(size=12),axis.title=element_text(size=14,face=&quot;bold&quot;)) +
  labs(y = &quot;Average daily milk yield (kg)&quot;, x = &quot;Days in milk&quot;) + theme(axis.text=element_text(size=12),axis.title=element_text(size=14,face=&quot;bold&quot;,family=&quot;Times&quot;),panel.background = element_rect(fill = &quot;white&quot;, colour = &quot;white&quot;,size = 0.5, linetype = &quot;solid&quot;),panel.grid.major = element_line(size = 0.5, linetype = &#39;solid&#39;, colour = &quot;grey&quot;), panel.grid.minor = element_line(size = 0.25, linetype = &#39;solid&#39;,colour = &quot;grey&quot;),legend.position=&quot;bottom&quot;,legend.text = element_text(family=&quot;Times&quot;, colour=&quot;black&quot;, size=12,face=&quot;bold&quot;)) + scale_color_brewer(palette=&quot;Set1&quot;)
curve</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-106-1.png" width="672" /></p>
</div>
<div id="step-7-model-diagnostics-1" class="section level3">
<h3>Step 7: Model diagnostics</h3>
<p>Checking homoskedasticity assumption (variance of residuals)</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + TestDIMcat20 + MYDO + (1|FARMID/Cow), data=lockcowdhi)
ggplot(data.frame(eta=predict(mm0,type=&quot;link&quot;),pearson=residuals(mm0,type=&quot;pearson&quot;)),
       aes(x=eta,y=pearson)) +
  geom_point() +
  theme_bw()</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-107-1.png" width="672" /></p>
<p><br></p>
<p>Vey little evidence of heteroskedasticity</p>
<p>Checking normality of residuals</p>
<pre class="r"><code>qqnorm(residuals(mm0))</code></pre>
<p><img src="CowAnalysis_files/figure-html/unnamed-chunk-108-1.png" width="672" /></p>
<p>I am happy with homoskedasticity and normal residuals assumptions</p>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
